!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RM=t():e.RM=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{install:function(){return y},version:function(){return v}});var n=0,r={token:"empty token",errorCount:0,tjsToken:"8de4c78a3ec64020ab2ad15dea1ae9ff",tjsApp:"rmagent",tjsVersion:"3.6.0",getErrorUrl:function(){return"https://capture.trackjs.com/capture?token="+r.tjsToken+"&v="+r.tjsVersion+"&source=rm"},error:function(e,t){if(void 0===t&&(t=null),!(n>=2)){var i=e||{},o=i.message||"empty",s=i.stack||(new Error).stack;r.errorCount++;var a=(self.location||"").toString(),u={agentPlatform:"browser",console:[{message:JSON.stringify(e),severity:"log",timestamp:(new Date).toISOString()}],customer:{token:r.tjsToken,application:r.tjsApp,userId:r.token,version:"1.2.0"},entry:"catch",environment:{originalUrl:a,userAgent:navigator.userAgent},message:o,url:a,stack:s,timestamp:(new Date).toISOString(),version:r.tjsVersion};null!=t&&u.console.push({message:t,severity:"log",timestamp:(new Date).toISOString()});var c=new XMLHttpRequest;c.open("POST",r.getErrorUrl()),c.send(JSON.stringify(u)),n++}}};function i(){return"undefined"==typeof document}function o(e){return(e=e||"").indexOf("?")>=0&&(e=e.split("?")[0]),e.length>=1e3&&(e=e.substr(0,1e3)),e}function s(e,t){return void 0===t&&(t=0),parseFloat(e.toFixed(t))}var a=["com","net","gov","edu","org"],u=["safeframe.googlesyndication.com","chrome-extension:","moz-extension:"],c=function(){function e(){this.hasSent=!1}return e.prototype.cacheResources=function(){this.hasSent||(e.cachedResourceTimings=e.getAllResources())},e.prototype.getResources=function(){var e=this;if(this.hasSent)return null;var t=this.getResourcesByOrigin();return Object.keys(t).map((function(n){return e.getResourceEntryByOrigin(n,t[n])}))},e.prototype.getPageResourceTimelines=function(){var t=e.getAllResources(),n=this.binResources(t),r=n.allImages,i=n.allScripts,o=n.allXhr,s=n.allCss,a=n.allFonts,u=n.allOther;return{imgTimeline:this.getTimeRangesForResources(r).join(","),xhrTimeline:this.getTimeRangesForResources(o).join(","),jsTimeline:this.getTimeRangesForResources(i).join(","),cssTimeline:this.getTimeRangesForResources(s).join(","),fontTimeline:this.getTimeRangesForResources(a).join(","),otherTimeline:this.getTimeRangesForResources(u).join(",")}},e.prototype.getResourcesByOrigin=function(){var t=this,n=e.getAllResources(),r={};return n.forEach((function(e){try{var n=t.getOriginFromResource(e);r[n]||(r[n]=[]),r[n].push(e)}catch(e){}})),r.__total=n,r},e.prototype.getOriginFromResource=function(e){var t=new URL(e.name).origin;return t.startsWith("https://www.google.")&&(t="https://www.google.com"),t},e.prototype.getResourceEntryByOrigin=function(e,t){var n=this.binResources(t),r=n.allImages,i=n.allScripts,o=n.allXhr,s=n.allCss,a=n.allFonts,u=n.allOther;return{origin:e,cssCount:s.length,cssTime:this.getWallClockTimeForResources(s),cssTimeline:this.getTimeRangesForResources(s).join(","),fontCount:a.length,fontTime:this.getWallClockTimeForResources(a),fontTimeline:this.getTimeRangesForResources(a).join(","),imgCount:r.length,imgTime:this.getWallClockTimeForResources(r),imgTimeline:this.getTimeRangesForResources(r).join(","),jsCount:i.length,jsTime:this.getWallClockTimeForResources(i),jsTimeline:this.getTimeRangesForResources(i).join(","),xhrCount:o.length,xhrTime:this.getWallClockTimeForResources(o),xhrTimeline:this.getTimeRangesForResources(o).join(","),otherCount:u.length,otherTime:this.getWallClockTimeForResources(u),otherTimeline:this.getTimeRangesForResources(u).join(","),totalCount:t.length,totalTime:this.getWallClockTimeForResources(t),totalTimeline:this.getTimeRangesForResources(t).join(",")}},e.getAllResources=function(){var t=(e.cachedResourceTimings||[]).concat(performance.getEntriesByType("resource")),n={};return t.filter((function(t){if(!t||e.shouldIgnore(t))return!1;var r=t.name+t.startTime;return!n[r]&&(n[r]=!0,!0)}))},e.shouldIgnore=function(e){return u.some((function(t){return e.name.toLowerCase().indexOf(t)>=0}))},e.prototype.binResources=function(e){var t=this,n=[],r=[],i=[],o=[],s=[],a=[];return e.forEach((function(e){t.isImage(e)?n.push(e):t.isScript(e)?r.push(e):t.isXhr(e)?i.push(e):t.isCss(e)?o.push(e):t.isFont(e)?s.push(e):a.push(e)})),{allImages:n,allScripts:r,allXhr:i,allCss:o,allFonts:s,allOther:a}},e.prototype.isImage=function(e){if("img"===e.initiatorType)return!0;try{if("css"===e.initiatorType||"link"===e.initiatorType){var t=new URL(e.name).pathname.toLowerCase();return[".jpg",".jpeg",".png",".gif",".svg",".raw",".webp",".heif",".avif"].some((function(e){return t.endsWith(e)}))}}catch(e){}return!1},e.prototype.isScript=function(e){if("script"===e.initiatorType)return!0;try{if("link"===e.initiatorType||"other"===e.initiatorType){var t=new URL(e.name).pathname.toLowerCase();return[".js",".json"].some((function(e){return t.endsWith(e)}))}}catch(e){}return!1},e.prototype.isXhr=function(e){return"fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType},e.prototype.isCss=function(e){if("link"!==e.initiatorType&&"css"!==e.initiatorType)return!1;try{return new URL(e.name).pathname.toLowerCase().endsWith("css")}catch(e){}return!1},e.prototype.isFont=function(e){if("link"!==e.initiatorType&&"css"!==e.initiatorType&&"other"!==e.initiatorType)return!1;try{var t=new URL(e.name).pathname.toLowerCase();return[".woff",".woff2",".ttf",".eot",".otf"].some((function(e){return t.endsWith(e)}))}catch(e){}return!1},e.prototype.getWallClockTimeForResources=function(e){return s(this.getTimeRangesForResources(e).reduce((function(e,t){return e+t.duration}),0))},e.prototype.getTimeRangesForResources=function(e){e=e.sort((function(e,t){return e.startTime-t.startTime}));var t=[];return e.forEach((function(e){var n=t[t.length-1];n&&n.isWithinRange(e)?n.applyTiming(e):t.push(new l(e))})),t},e.prototype.sentResources=function(){this.hasSent=!0,e.cachedResourceTimings=null},e.cachedResourceTimings=null,e}(),l=function(){function e(e){this.start=e.startTime,this.end=e.responseEnd}return Object.defineProperty(e.prototype,"duration",{get:function(){return this.end-this.start},enumerable:!0,configurable:!0}),e.prototype.isWithinRange=function(e){return e.startTime<=this.end},e.prototype.applyTiming=function(e){this.end<e.responseEnd&&(this.end=e.responseEnd)},e.prototype.toString=function(){return s(this.start)+"-"+s(this.end)},e}(),f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},h=function(){function e(){this.hasSentPage=!1}return e.prototype.getPageUrl=function(){return this.pageUrl||o(self.location.toString())},e.prototype.getPageEntry=function(){if(i())return null;if(this.hasSentPage)return null;var e=performance.getEntriesByType("navigation")[0],t=null;if(e)t={url:o(0===e.name.indexOf("http")?e.name:self.location.toString()),start:s(e.startTime),duration:s(e.duration),domInteractive:s(e.domInteractive),dnsTime:s(e.domainLookupEnd-e.domainLookupStart),sslTime:s(e.connectEnd-e.connectStart),serverTime:s(e.responseEnd-e.requestStart),blockingAssetLoadTime:s(e.domInteractive-e.responseEnd),firstByteTime:s(e.responseStart),pageSize:e.transferSize};else{var n=performance.timing;t={url:o(self.location.toString()),start:0,duration:s(n.domComplete-n.navigationStart),domInteractive:s(n.domInteractive-n.navigationStart),dnsTime:s(n.domainLookupEnd-n.domainLookupStart),sslTime:s(n.connectEnd-n.connectStart),serverTime:s(n.responseEnd-n.requestStart),blockingAssetLoadTime:s(n.domInteractive-n.responseEnd),firstByteTime:s(n.responseStart-n.navigationStart)}}this.pageUrl=t.url;var r=(new c).getPageResourceTimelines();return f(f({},t),r)},e.prototype.sentPage=function(){this.hasSentPage=!0},e}(),p=function(){function e(e){var t=this;this.vitalsSent=!1,this.userInteracted=!1,this.isUnloading=!1,this.isBackgroundTab=!1,this.cls=null,this.lcp=null,this.fid=null,this.fcp=null,this.handleLayoutShift=function(e){e.hadRecentInput||(t.cls+=e.value)},this.handleLargestPaint=function(e){e.startTime>t.lcp&&(t.lcp=e.startTime)},this.handleFirstPaint=function(e){"first-contentful-paint"===e.name&&e.startTime&&(t.fcp=e.startTime)},this.handleFirstInput=function(e){t.fid=e.processingStart-e.startTime},i()?this.isBackgroundTab=!0:(self.addEventListener("keydown",(function(){t.userInteracted=!0,e()}),{once:!0,capture:!0}),self.addEventListener("click",(function(){t.userInteracted=!0,e()}),{once:!0,capture:!0}),setTimeout((function(){t.userInteracted=!0,e()}),3e4),self.addEventListener("pagehide",(function(e){t.isUnloading=!e.persisted})),this.isBackgroundTab="hidden"===document.visibilityState,document.addEventListener("visibilitychange",(function(e){t.isUnloading||(t.isBackgroundTab=!0)}),{once:!0}),this.layoutObserver=this.addPerformanceObserver("layout-shift",this.handleLayoutShift),this.layoutObserver&&(this.cls=0),this.largestPaintObserver=this.addPerformanceObserver("largest-contentful-paint",this.handleLargestPaint),this.largestPaintObserver&&(this.lcp=0),this.firstPaintObserver=this.addPerformanceObserver("paint",this.handleFirstPaint),this.firstPaintObserver&&(this.fcp=0),this.firstInputObserver=this.addPerformanceObserver("first-input",this.handleFirstInput))}return e.prototype.getVitals=function(e){if(this.isBackgroundTab)return null;if(this.vitalsSent)return null;if(!this.userInteracted&&!this.isUnloading)return null;var t=!1,n={url:e};return null!==this.cls&&(n.cls=s(this.cls,5),t=!0),null!==this.lcp&&this.lcp>0&&(n.lcp=s(this.lcp),t=!0),null!==this.fcp&&this.fcp>0&&(n.fcp=s(this.fcp),t=!0),null!==this.fid&&(n.fid=s(this.fid,1),t=!0),t?n:null},e.prototype.sentVitals=function(){var e,t,n,r;null===(e=this.layoutObserver)||void 0===e||e.disconnect(),null===(t=this.firstInputObserver)||void 0===t||t.disconnect(),null===(n=this.firstPaintObserver)||void 0===n||n.disconnect(),null===(r=this.largestPaintObserver)||void 0===r||r.disconnect(),this.vitalsSent=!0},e.prototype.addPerformanceObserver=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.indexOf(e)>=0){var n=new PerformanceObserver((function(e){return e.getEntries().map((function(e){try{return t(e)}catch(e){r.error(e)}}))}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},e}(),g=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r},d=function(){function e(t){var n=this;if(this.timeOrigin=null,this.entryHash={},this.endpoints=[],this.pageService=new h,this.resourceService=new c,this.shutdownSend=!1,this.sendCount=0,this.getIngestUrl=function(){return n.options.ingestUrl+"?token="+n.options.token+"&v=1.2.0"},this.sendBeacon=function(){try{var e=n.getPayload();if(navigator.sendBeacon&&n.payloadHasData(e)){n.clearPayloadAfterSend(e);var t=n.getIngestUrl(),i=JSON.stringify(e);try{navigator.sendBeacon(t,i)}catch(e){}}}catch(e){r.error(e)}},self.performance&&self.performance.getEntriesByType&&self.URL&&self.URL.prototype&&"hostname"in self.URL.prototype){var o,s=performance.getEntriesByType("navigation")||[];(i()||s.length||performance.timing)&&(this.options=Object.keys(e.defaults).reduce((function(n,r){return n[r]=t[r]||e.defaults[r],n}),{}),this.timeOrigin=performance.timeOrigin||(performance.timing||{}).navigationStart||(new Date).getTime(),this.manageResourceBuffer(),o=function(){try{n.webVitalsObserver=new p((function(){n.checkAndSend()})),setTimeout((function(){return n.checkAndSend()}),1e3),setInterval((function(){return n.checkAndSend()}),6e4),self.addEventListener("pagehide",(function(){return n.sendBeacon()})),self.addEventListener("visibilitychange",(function(){i()||"hidden"!==document.visibilityState||n.sendBeacon()}))}catch(e){r.error(e)}},i()||"complete"===document.readyState?o():document.addEventListener("readystatechange",(function(e){"complete"===document.readyState&&o()})))}}return e.prototype.getEndpointEntries=function(){var e=this,t=[];return c.getAllResources().forEach((function(n){if(!(Object.keys(e.entryHash).length>=50||n.duration<=0||"xmlhttprequest"!==n.initiatorType&&"fetch"!==n.initiatorType)){var i=o(n.name);if(function(e,t){var n=function(e){try{if(!e||0!==e.indexOf("http"))return null;var t=new URL(e).hostname;if(!t)return null;var n=t.split("."),i=n.pop();if("localhost"===i)return i;if("127.0.0.1"===t)return t;var o=n.pop();return 2===o.length&&(o=n.pop()),a.indexOf(o)>=0&&(o=n.pop()),o+"."}catch(t){return r.error(t,"Page Url: "+e),null}}(t);if(!n)return!1;try{var i=new URL(e).hostname;return!!i&&i.indexOf(n)>=0}catch(t){return r.error(t,"Problem parsing first party url: "+e),!1}}(i,self.location.toString())){var u=i+n.startTime;e.entryHash[u]||(e.options.monitorSelfCalls||0!==e.getIngestUrl().indexOf(i))&&(r.errorCount>0&&0===r.getErrorUrl().indexOf(i)||(e.entryHash[u]=!0,t.push({url:i,start:s(n.startTime),duration:s(n.duration)})))}}})),t},e.prototype.getDevice=function(){try{if(/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return"mobile"}catch(e){}return"desktop"},e.prototype.getPayload=function(){var e;return this.endpoints=this.endpoints.concat(this.getEndpointEntries()),{token:this.options.token,timeOrigin:new Date(this.timeOrigin).toISOString(),timeSent:(new Date).toISOString(),device:this.getDevice(),page:this.pageService.getPageEntry(),endpoints:g(this.endpoints),vitals:null===(e=this.webVitalsObserver)||void 0===e?void 0:e.getVitals(this.pageService.getPageUrl()),resources:this.resourceService.getResources(),tags:this.options.tags}},e.prototype.payloadHasData=function(e){return!(this.shutdownSend||this.sendCount>=10||!e||!(e.page||e.endpoints.length||e.vitals||e.resources))},e.prototype.shouldSendInterval=function(e){return!!this.payloadHasData(e)&&!!(e.page||e.vitals||e.resources||i()||e.endpoints.length>=10)},e.prototype.checkAndSend=function(){var e=this;try{var t=this.getPayload();if(!this.shouldSendInterval(t))return;this.clearPayloadAfterSend(t);var n=new XMLHttpRequest;n.open("POST",this.getIngestUrl()),n.setRequestHeader("Content-Type","application/json"),n.addEventListener("load",(function(){n.status>=400&&(e.shutdownSend=!0)})),n.send(JSON.stringify(t))}catch(e){r.error(e)}},e.prototype.clearPayloadAfterSend=function(e){var t;this.sendCount++,this.endpoints.length=0,e.page&&this.pageService.sentPage(),e.vitals&&(null===(t=this.webVitalsObserver)||void 0===t||t.sentVitals()),e.resources&&this.resourceService.sentResources()},e.prototype.manageResourceBuffer=function(){var e=this;performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(1e3);var t=function(t){e.resourceService.cacheResources(),performance.clearResourceTimings()};if(performance.addEventListener)try{performance.addEventListener("resourcetimingbufferfull",t)}catch(e){}else performance.onresourcetimingbufferfull=t},e.defaults={token:null,ingestUrl:"https://in.requestmetrics.com/v1",monitorSelfCalls:!1,tags:[]},e}(),m={__agent:null,version:"1.2.0",install:function(e){try{if(m.__agent)return void console.warn("Request Metrics is already installed.");if(!e||!e.token)return void console.error("You must provide a token to install Request Metrics.");r.token=e.token,m.__agent=new d(e)}catch(e){r.error(e)}}},v=m.version,y=m.install;return function(){try{if(i())return;var e=document.querySelector("[data-rm-token]");if(!e)return;var t=e.getAttribute("data-rm-token");if(!t)return;var n=(e.getAttribute("data-rm-tags")||"").split(",").filter((function(e){return e}));r.token=t,m.install({token:t,ingestUrl:e.getAttribute("data-rm-ingest"),monitorSelfCalls:!!e.getAttribute("data-rm-monitor-self"),tags:n})}catch(e){r.error(e)}}(),t}()}));
//# sourceMappingURL=rm.js.map