let e;const t={},s=function(s,i){if(!i)return s();if(void 0===e){const t=document.createElement("link").relList;e=t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(i.map((s=>{if(s in t)return;t[s]=!0;const i=s.endsWith(".css"),n=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const o=document.createElement("link");return o.rel=i?"stylesheet":e,i||(o.as="script",o.crossOrigin=""),o.href=s,document.head.appendChild(o),i?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>s()))},i="undefined"!=typeof self?self:null,n="undefined"!=typeof window?window:null,o=i||n||void 0,r=0,a=1,c=2,h=3,l="closed",d="errored",u="joined",f="joining",p="leaving",g="phx_close",m="phx_error",w="phx_join",E="phx_reply",T="phx_leave",C=[g,m,w,E,T],S="longpoll",k="websocket";let I=e=>{if("function"==typeof e)return e;return function(){return e}};class y{constructor(e,t,s,i){this.channel=e,this.event=t,this.payload=s||function(){return{}},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,ref:s}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,(e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}class U{constructor(e,t,s){this.state=l,this.topic=e,this.params=I(t||{}),this.socket=s,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new y(this,w,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new b((()=>{this.socket.isConnected()&&this.rejoin()}),this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError((()=>this.rejoinTimer.reset()))),this.stateChangeRefs.push(this.socket.onOpen((()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()}))),this.joinPush.receive("ok",(()=>{this.state=u,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this.joinPush.receive("error",(()=>{this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.onClose((()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=l,this.socket.remove(this)})),this.onError((e=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,e),this.isJoining()&&this.joinPush.reset(),this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.joinPush.receive("timeout",(()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new y(this,T,I({}),this.timeout).send(),this.state=d,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.on(E,((e,t)=>{this.trigger(this.replyEventName(t),e)}))}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(g,e)}onError(e){return this.on(m,(t=>e(t)))}on(e,t){let s=this.bindingRef++;return this.bindings.push({event:e,ref:s,callback:t}),s}off(e,t){this.bindings=this.bindings.filter((s=>!(s.event===e&&(void 0===t||t===s.ref))))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,s=this.timeout){if(t=t||{},!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let i=new y(this,e,(function(){return t}),s);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=p;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(g,"leave")},s=new y(this,T,I({}),e);return s.receive("ok",(()=>t())).receive("timeout",(()=>t())),s.send(),this.canPush()||s.trigger("ok",{}),s}onMessage(e,t,s){return t}isLifecycleEvent(e){return C.indexOf(e)>=0}isMember(e,t,s,i){return this.topic===e&&(!i||i===this.joinRef()||!this.isLifecycleEvent(t)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:s,joinRef:i}),!1))}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=f,this.joinPush.resend(e))}trigger(e,t,s,i){let n=this.onMessage(e,t,s,i);if(t&&!n)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");let o=this.bindings.filter((t=>t.event===e));for(let r=0;r<o.length;r++){o[r].callback(n,s,i||this.joinRef())}}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===l}isErrored(){return this.state===d}isJoined(){return this.state===u}isJoining(){return this.state===f}isLeaving(){return this.state===p}}let R={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode(e,t){if(e.payload.constructor===ArrayBuffer)return t(this.binaryEncode(e));{let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}},decode(e,t){if(e.constructor===ArrayBuffer)return t(this.binaryDecode(e));{let[s,i,n,o,r]=JSON.parse(e);return t({join_ref:s,ref:i,topic:n,event:o,payload:r})}},binaryEncode(e){let{join_ref:t,ref:s,event:i,topic:n,payload:o}=e,r=this.META_LENGTH+t.length+s.length+n.length+i.length,a=new ArrayBuffer(this.HEADER_LENGTH+r),c=new DataView(a),h=0;c.setUint8(h++,this.KINDS.push),c.setUint8(h++,t.length),c.setUint8(h++,s.length),c.setUint8(h++,n.length),c.setUint8(h++,i.length),Array.from(t,(e=>c.setUint8(h++,e.charCodeAt(0)))),Array.from(s,(e=>c.setUint8(h++,e.charCodeAt(0)))),Array.from(n,(e=>c.setUint8(h++,e.charCodeAt(0)))),Array.from(i,(e=>c.setUint8(h++,e.charCodeAt(0))));var l=new Uint8Array(a.byteLength+o.byteLength);return l.set(new Uint8Array(a),0),l.set(new Uint8Array(o),a.byteLength),l.buffer},binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.push:return this.decodePush(e,t,i);case this.KINDS.reply:return this.decodeReply(e,t,i);case this.KINDS.broadcast:return this.decodeBroadcast(e,t,i)}},decodePush(e,t,s){let i=t.getUint8(1),n=t.getUint8(2),o=t.getUint8(3),r=this.HEADER_LENGTH+this.META_LENGTH-1,a=s.decode(e.slice(r,r+i));r+=i;let c=s.decode(e.slice(r,r+n));r+=n;let h=s.decode(e.slice(r,r+o));return r+=o,{join_ref:a,ref:null,topic:c,event:h,payload:e.slice(r,e.byteLength)}},decodeReply(e,t,s){let i=t.getUint8(1),n=t.getUint8(2),o=t.getUint8(3),r=t.getUint8(4),a=this.HEADER_LENGTH+this.META_LENGTH,c=s.decode(e.slice(a,a+i));a+=i;let h=s.decode(e.slice(a,a+n));a+=n;let l=s.decode(e.slice(a,a+o));a+=o;let d=s.decode(e.slice(a,a+r));a+=r;let u=e.slice(a,e.byteLength);return{join_ref:c,ref:h,topic:l,event:E,payload:{status:d,response:u}}},decodeBroadcast(e,t,s){let i=t.getUint8(1),n=t.getUint8(2),o=this.HEADER_LENGTH+2,r=s.decode(e.slice(o,o+i));o+=i;let a=s.decode(e.slice(o,o+n));return o+=n,{join_ref:null,ref:null,topic:r,event:a,payload:e.slice(o,e.byteLength)}}};class v{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||1e4,this.transport=t.transport||o.WebSocket||A,this.defaultEncoder=R.encode.bind(R),this.defaultDecoder=R.decode.bind(R),this.closeWasClean=!1,this.unloaded=!1,this.binaryType=t.binaryType||"arraybuffer",this.transport!==A?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),n&&n.addEventListener&&n.addEventListener("unload",(e=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))})),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=e=>t.rejoinAfterMs?t.rejoinAfterMs(e):[1e3,2e3,5e3][e-1]||1e4,this.reconnectAfterMs=e=>this.unloaded?100:t.reconnectAfterMs?t.reconnectAfterMs(e):[10,50,100,150,200,250,500,1e3,2e3][e-1]||5e3,this.logger=t.logger||null,this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=I(t.params||{}),this.endPoint=`${e}/${k}`,this.vsn=t.vsn||"2.0.0",this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new b((()=>{this.teardown((()=>this.connect()))}),this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=L.appendParams(L.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,s){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,s)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=I(e)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=e=>this.onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this.onConnClose(e))}log(e,t,s){this.logger(e,t,s)}hasLogger(){return null!==this.logger}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}onConnOpen(){this.hasLogger()&&this.log("transport",`connected to ${this.endPointURL()}`),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach((([,e])=>e()))}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs))}teardown(e,t,s){if(!this.conn)return e&&e();this.waitForBufferDone((()=>{this.conn&&(t?this.conn.close(t,s||""):this.conn.close()),this.waitForSocketClosed((()=>{this.conn&&(this.conn.onclose=function(){},this.conn=null),e&&e()}))}))}waitForBufferDone(e,t=1){5!==t&&this.conn&&this.conn.bufferedAmount?setTimeout((()=>{this.waitForBufferDone(e,t+1)}),150*t):e()}waitForSocketClosed(e,t=1){5!==t&&this.conn&&this.conn.readyState!==h?setTimeout((()=>{this.waitForSocketClosed(e,t+1)}),150*t):e()}onConnClose(e){this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((([,t])=>t(e)))}onConnError(e){this.hasLogger()&&this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach((([,t])=>t(e)))}triggerChanError(){this.channels.forEach((e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(m)}))}connectionState(){switch(this.conn&&this.conn.readyState){case r:return"connecting";case a:return"open";case c:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter((t=>t.joinRef()!==e.joinRef()))}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter((([t])=>-1===e.indexOf(t)))}channel(e,t={}){let s=new U(e,t,this);return this.channels.push(s),s}push(e){if(this.hasLogger()){let{topic:t,event:s,payload:i,ref:n,join_ref:o}=e;this.log("push",`${t} ${s} (${o}, ${n})`,i)}this.isConnected()?this.encode(e,(e=>this.conn.send(e))):this.sendBuffer.push((()=>this.encode(e,(e=>this.conn.send(e)))))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(e){this.closeWasClean=!1,this.conn.readyState===a&&this.conn.close(1e3,e)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:i,ref:n,join_ref:o}=e;n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${i.status||""} ${t} ${s} ${n&&"("+n+")"||""}`,i);for(let r=0;r<this.channels.length;r++){const e=this.channels[r];e.isMember(t,s,i,o)&&e.trigger(s,i,n,o)}for(let r=0;r<this.stateChangeCallbacks.message.length;r++){let[,t]=this.stateChangeCallbacks.message[r];t(e)}}))}leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t.isJoined()||t.isJoining())));t&&(this.hasLogger()&&this.log("transport",`leaving duplicate topic "${e}"`),t.leave())}}class A{constructor(e){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=r,this.poll()}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+k),"$1/"+S)}endpointURL(){return L.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=r}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==a&&this.readyState!==r||L.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),(e=>{if(e){var{status:t,token:s,messages:i}=e;this.token=s}else var t=0;switch(t){case 200:i.forEach((e=>this.onmessage({data:e}))),this.poll();break;case 204:this.poll();break;case 410:this.readyState=a,this.onopen(),this.poll();break;case 403:this.onerror(),this.close();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error(`unhandled poll status ${t}`)}}))}send(e){L.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),(e=>{e&&200===e.status||(this.onerror(e&&e.status),this.closeAndRetry())}))}close(e,t){this.readyState=h,this.onclose()}}class L{static request(e,t,s,i,n,r,a){if(o.XDomainRequest){let s=new XDomainRequest;this.xdomainRequest(s,e,t,i,n,r,a)}else{let c=new o.XMLHttpRequest;this.xhrRequest(c,e,t,s,i,n,r,a)}}static xdomainRequest(e,t,s,i,n,o,r){e.timeout=n,e.open(t,s),e.onload=()=>{let t=this.parseJSON(e.responseText);r&&r(t)},o&&(e.ontimeout=o),e.onprogress=()=>{},e.send(i)}static xhrRequest(e,t,s,i,n,o,r,a){e.open(t,s,!0),e.timeout=o,e.setRequestHeader("Content-Type",i),e.onerror=()=>{a&&a(null)},e.onreadystatechange=()=>{if(e.readyState===this.states.complete&&a){let t=this.parseJSON(e.responseText);a(t)}},r&&(e.ontimeout=r),e.send(n)}static parseJSON(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let s=[];for(var i in e){if(!e.hasOwnProperty(i))continue;let n=t?`${t}[${i}]`:i,o=e[i];"object"==typeof o?s.push(this.serialize(o,n)):s.push(encodeURIComponent(n)+"="+encodeURIComponent(o))}return s.join("&")}static appendParams(e,t){if(0===Object.keys(t).length)return e;let s=e.match(/\?/)?"&":"?";return`${e}${s}${this.serialize(t)}`}}L.states={complete:4};class b{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}var O,N=new Uint8Array(16);function _(){if(!O&&!(O="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(N)}var D=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function P(e){return"string"==typeof e&&D.test(e)}for(var F=[],M=0;M<256;++M)F.push((M+256).toString(16).substr(1));function j(e,t,s){var i=(e=e||{}).random||(e.rng||_)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){s=s||0;for(var n=0;n<16;++n)t[s+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(F[e[t+0]]+F[e[t+1]]+F[e[t+2]]+F[e[t+3]]+"-"+F[e[t+4]]+F[e[t+5]]+"-"+F[e[t+6]]+F[e[t+7]]+"-"+F[e[t+8]]+F[e[t+9]]+"-"+F[e[t+10]]+F[e[t+11]]+F[e[t+12]]+F[e[t+13]]+F[e[t+14]]+F[e[t+15]]).toLowerCase();if(!P(s))throw TypeError("Stringified UUID is invalid");return s}(i)}class B extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,B.prototype),this.name="UserflowError",this.code=t}}class H{constructor(e){this.type=e,this.testState={}}formatKey(e){return`userflow:${e}`}getItem(e){return e=this.formatKey(e),"undefined"==typeof window?null:window[this.type].getItem(e)}setItem(e,t){e=this.formatKey(e),"undefined"!=typeof window&&window[this.type].setItem(e,t)}removeItem(e){if(e=this.formatKey(e),"undefined"!=typeof window)return window[this.type].removeItem(e)}clear(){if("undefined"!=typeof window)return window[this.type].clear()}}const x=new H("localStorage"),$=new H("sessionStorage");function G(e){window.location.href=e}function W(){return window.location.href}var V,K,J;function z(e,t,{toOrigin:s}={}){e.postMessage(t,s||"*")}function q(e,{fromWindow:t,fromOrigin:s}={}){const i=i=>{if(!i.isTrusted)return;if(t&&t!==i.source)return;if(s&&i.origin!==s)return;const o=i.data;o&&"object"==typeof o&&"string"==typeof o.kind&&o.kind.startsWith("userflow:")&&!0===e(o)&&n()};window.addEventListener("message",i);const n=()=>window.removeEventListener("message",i);return n}(V||(V={})).INPUT="INPUT",(J=K||(K={})).AUTO="AUTO",J.MANUAL="MANUAL";const X=new Set;let Y=!1;function Q(e){return function(){if(Y)return;Y=!0;const{history:e}=window,t=t=>{const s=e[t];e[t]=(...t)=>{s.apply(e,t),ee()}};t("pushState"),t("replaceState"),window.addEventListener("popstate",(()=>{ee()}))}(),X.add(e),()=>{Z(e)}}function Z(e){X.delete(e)}function ee(){X.forEach((e=>e()))}class te{destroy(){this.unregisterOnMessage&&this.unregisterOnMessage()}postBuilderMessage(e){z(window.opener,e,{toOrigin:"https://userflow.com"})}onBuilderMessage(e){return this.unregisterOnMessage=q(e,{fromOrigin:"https://userflow.com"}),!1}async captureScreenshot(e,t,s,i){z(window,{kind:"userflow:crxScreenshot",x:e,y:t,width:s,height:i,devicePixelRatio:window.devicePixelRatio});var n;return(await(n=e=>"userflow:crxScreenshotResult"===e.kind?e:null,new Promise((e=>{q((t=>{const s=n(t);return!!s&&(e(s),!0)}))})))).imageDataUrl}}var se,ie,ne,oe,re,ae,ce,he,le,de,ue,fe,pe,ge,me,we,Ee,Te,Ce,Se,ke,Ie,ye,Ue,Re,ve,Ae,Le,be,Oe,Ne,_e,De,Pe,Fe,Me,je,Be,He,xe,$e,Ge,We,Ve,Ke,Je,ze,qe,Xe,Ye,Qe,Ze,et,tt,st,it,nt,ot,rt,at,ct,ht,lt,dt,ut,ft,pt,gt;(ie=se||(se={})).ACTION="ACTION",ie.LAUNCHER_DEACTIVATED="LAUNCHER_DEACTIVATED",ie.REPLACED="REPLACED",ie.TOOLTIP_TARGET_MISSING="TOOLTIP_TARGET_MISSING",ie.USERFLOWJS="USERFLOWJS",ie.USER_CLOSED="USER_CLOSED",(oe=ne||(ne={})).ACTION="ACTION",oe.DRAFT="DRAFT",oe.LINK="LINK",oe.LAUNCHER_SEEN="LAUNCHER_SEEN",oe.RESOURCE_CENTER="RESOURCE_CENTER",oe.USERFLOWJS="USERFLOWJS",(ae=re||(re={})).STRING="STRING",ae.BOOLEAN="BOOLEAN",ae.NUMBER="NUMBER",ae.DATETIME="DATETIME",(he=ce||(ce={})).FLOW="FLOW",he.CHECKLIST="CHECKLIST",he.LAUNCHER="LAUNCHER",he.RESOURCE_CENTER="RESOURCE_CENTER",(de=le||(le={})).ASSET="ASSET",de.CARTOON="CARTOON",de.NONE="NONE",de.URL="URL",(fe=ue||(ue={})).INSIDE="INSIDE",fe.OUTSIDE="OUTSIDE",(ge=pe||(pe={})).TOP_LEFT="TOP_LEFT",ge.TOP_CENTER="TOP_CENTER",ge.TOP_RIGHT="TOP_RIGHT",ge.BOTTOM_RIGHT="BOTTOM_RIGHT",ge.BOTTOM_CENTER="BOTTOM_CENTER",ge.BOTTOM_LEFT="BOTTOM_LEFT",ge.CENTER="CENTER",(we=me||(me={})).GOOGLE="GOOGLE",we.STANDARD="STANDARD",(Te=Ee||(Ee={})).DISMISS_FIRST_MENU_AFTER="DISMISS_FIRST_MENU_AFTER",Te.DISMISS="DISMISS",(Se=Ce||(Ce={})).DISMISS="DISMISS",Se.NONE="NONE",(Ie=ke||(ke={})).DEFAULT="DEFAULT",Ie.PLAINTEXT="PLAINTEXT",(Ue=ye||(ye={})).BUBBLE="BUBBLE",Ue.END="END",Ue.ERROR="ERROR",Ue.FLAG="FLAG",(ve=Re||(Re={})).MANUAL="MANUAL",ve.NONE="NONE",ve.SYNTHETIC="SYNTHETIC",(Le=Ae||(Ae={})).BUBBLE="BUBBLE",Le.HIDDEN="HIDDEN",Le.MODAL="MODAL",Le.TOOLTIP="TOOLTIP",function(e){e.AUTO="AUTO",e.MANUAL="MANUAL"}(be||(be={})),(Oe||(Oe={})).INPUT="INPUT",(_e=Ne||(Ne={})).ABOVE="ABOVE",_e.BELOW="BELOW",_e.LEFT="LEFT",_e.RIGHT="RIGHT",(Pe=De||(De={})).DEFAULT="DEFAULT",Pe.PRIMARY="PRIMARY",(Me=Fe||(Fe={})).CLOSE_FLOW="CLOSE_FLOW",Me.EVAL_JS="EVAL_JS",Me.GO_TO_STEP="GO_TO_STEP",Me.NAVIGATE="NAVIGATE",Me.START_FLOW="START_FLOW",(Be=je||(je={})).NEW_TAB="NEW_TAB",Be.SAME_TAB="SAME_TAB",(xe=He||(He={})).ATTRIBUTE="ATTRIBUTE",xe.CLAUSE="CLAUSE",xe.ELEMENT="ELEMENT",xe.FILLED_IN_INPUT="FILLED_IN_INPUT",xe.FLOW="FLOW",xe.INPUT_VALUE="INPUT_VALUE",xe.PAGE="PAGE",(Ge=$e||($e={})).ABSOLUTE_EQ="ABSOLUTE_EQ",Ge.ABSOLUTE_GT="ABSOLUTE_GT",Ge.ABSOLUTE_LT="ABSOLUTE_LT",Ge.AND="AND",Ge.CONTAINS="CONTAINS",Ge.EMPTY="EMPTY",Ge.ENDS_WITH="ENDS_WITH",Ge.EQ="EQ",Ge.FALSE="FALSE",Ge.GT="GT",Ge.LT="LT",Ge.NE="NE",Ge.NOT_CONTAINS="NOT_CONTAINS",Ge.NOT_EMPTY="NOT_EMPTY",Ge.NOT_REGEX="NOT_REGEX",Ge.OR="OR",Ge.REGEX="REGEX",Ge.RELATIVE_EQ="RELATIVE_EQ",Ge.RELATIVE_GT="RELATIVE_GT",Ge.RELATIVE_LT="RELATIVE_LT",Ge.STARTS_WITH="STARTS_WITH",Ge.TRUE="TRUE",Ge.URL="URL",(Ve=We||(We={})).CLICK="CLICK",Ve.DISABLED="DISABLED",Ve.MOUSEDOWN="MOUSEDOWN",Ve.NOT_CLICK="NOT_CLICK",Ve.NOT_DISABLED="NOT_DISABLED",Ve.NOT_PRESENT="NOT_PRESENT",Ve.PRESENT="PRESENT",(Je=Ke||(Ke={})).MULTILINE_TEXT="MULTILINE_TEXT",Je.MULTIPLE_CHOICE="MULTIPLE_CHOICE",Je.NPS="NPS",Je.SCALE="SCALE",Je.STARS="STARS",Je.TEXT="TEXT",(qe=ze||(ze={})).ACTION="ACTION",qe.CHECKLIST="CHECKLIST",qe.CONTACT="CONTACT",qe.FLOWS="FLOWS",qe.KNOWLEDGE_BASE="KNOWLEDGE_BASE",qe.MESSAGE="MESSAGE",qe.SUBPAGE="SUBPAGE",(Ye=Xe||(Xe={})).CRISP="CRISP",Ye.CUSTOM="CUSTOM",Ye.FRESHCHAT="FRESHCHAT",Ye.HELPSCOUT="HELPSCOUT",Ye.HUBSPOT="HUBSPOT",Ye.INTERCOM="INTERCOM",Ye.ZENDESK="ZENDESK",(Ze=Qe||(Qe={})).LAUNCHER_CLICK="LAUNCHER_CLICK",Ze.LAUNCHER_HOVER="LAUNCHER_HOVER",Ze.TARGET_CLICK="TARGET_CLICK",Ze.TARGET_HOVER="TARGET_HOVER",Ze.LAUNCHER_TARGET_CLICK="LAUNCHER_TARGET_CLICK",Ze.LAUNCHER_TARGET_HOVER="LAUNCHER_TARGET_HOVER",(tt=et||(et={})).ACTIVATE="ACTIVATE",tt.DEACTIVATE="DEACTIVATE",tt.NEVER="NEVER",(it=st||(st={})).AUTO="AUTO",it.TOP="TOP",it.RIGHT="RIGHT",it.BOTTOM="BOTTOM",it.LEFT="LEFT",(ot=nt||(nt={})).START="START",ot.CENTER="CENTER",ot.END="END",(at=rt||(rt={})).PERCENT="PERCENT",at.PX="PX",(ht=ct||(ct={})).BEACON="BEACON",ht.BUTTON="BUTTON",ht.HIDDEN="HIDDEN",ht.ICON="ICON",(dt=lt||(lt={})).LAUNCHER="LAUNCHER",dt.TARGET="TARGET",(ft=ut||(ut={})).ACTIVE="ACTIVE",ft.COMPLETED="COMPLETED",ft.ENDED="ENDED",ft.NOT_SEEN="NOT_SEEN",(gt=pt||(pt={})).HIGHLIGHT="HIGHLIGHT",gt.MODAL="MODAL",gt.HIGHLIGHT_MODAL="HIGHLIGHT_MODAL";const mt={customInputs:[],customNavigate:null,urlFilter:null,customScrollIntoView:null,scrollPadding:null,inferenceAttributeNames:["data-for","data-id","data-testid","data-test-id","for","id","name","placeholder","role"],inferenceAttributeFilters:{id:[e=>!e.match(/\d$/)],"data-id":[e=>!e.match(/\d$/)]},inferenceClassNameFilters:[e=>!e.startsWith("css-")]};function wt(e){return Array.isArray(e)||(e=e?[e]:[]),e=e.map((e=>"string"==typeof e?new RegExp(e):e))}function Et(e,t){return e.every((e=>"function"==typeof e?e(t):!(e instanceof RegExp)||e.test(t)))}function Tt(){let e=W();if(mt.urlFilter){if(e=mt.urlFilter(e),"string"!=typeof e)throw new B("Userflow.js: URL filter returned non-string value. Please check your userflow.setUrlFilter() implementation.");try{new URL(e)}catch(t){throw new B("Userflow.js: URL filter returned an invalid URL. Please check your userflow.setUrlFilter() implementation.\nReturned URL: "+e+"\nError message: "+t.message)}}return e}const Ct=(localStorage.getItem("debug")||"").split(",").some((e=>"*"===e||e.startsWith("userflow:*"))),St=It("log");let kt;function It(e){return function(t,...s){if(Ct){const i=performance.now(),n=kt?Math.round(i-kt):0;kt=i,console[e](`%cuserflow %c${t} %c+${n}ms`,"color:#4579E4;","","color:#4579E4;",...s)}}}St.group=It("group"),St.groupCollapsed=It("groupCollapsed"),St.groupEnd=function(){Ct&&console.groupEnd()};const yt=()=>s((()=>import("./ResourceCenterApp.06680316.js")),[new URL("ResourceCenterApp.06680316.js",import.meta.url).toString(),new URL("index.9a316d5c.js",import.meta.url).toString(),new URL("Icons.98156ed7.js",import.meta.url).toString(),new URL("BubbleToolbar.b33bc7de.js",import.meta.url).toString(),new URL("interpolate-session-data.e82e82f6.js",import.meta.url).toString(),new URL("stylesheets.68647110.js",import.meta.url).toString(),new URL("logomark.cffe7258.js",import.meta.url).toString(),new URL("dom-helpers.e87fd37d.js",import.meta.url).toString(),new URL("DynamicIcon.c1058a03.js",import.meta.url).toString(),new URL("ChecklistUI.cd23aab1.js",import.meta.url).toString()]);function Ut(e){const t=e.version.checklist.tasks.length;return Math.max(0,t-e.taskCompletions.length)}const Rt=import.meta.url;class vt{constructor(){this.clientToken=null,this.externalId=null,this.signature=null,this.groupId=null,this.groupSignature=null,this._socketStatus="disconnected",this.socket=null,this.channel=null,this.featureFlags=new Set,this.debounceInactiveDisconnectTimeout=void 0,this.inBatch=!1,this.endBatchTimeout=void 0,this.pushRateLimitMinute=0,this.pushRateLimitMinuteExpires=0,this.clientClock=1,this.serverClock=1,this.flowSession=null,this.flowSessionClock=0,this.checklistSession=null,this.checklistExpanded=!1,this.checklistExpandPending=!1,this.checklistSessionClock=0,this.resourceCenterSession=null,this.resourceCenterOpen=!1,this.resourceCenterLauncherHidden=!1,this.launcherSessions=[],this.activeLauncherFlowId=null,this.notifications=[],this.notificationIdCounter=0,this.sessionStorageState=null,this.clientContext=null,this.flushUrlChangeTimeout=void 0,this.onFirstIdentifyRun=!1,this.firstIdentifyCallback=null,this.cancelPollVersionChange=void 0,this.ui=null,this.unackedTasks=new Set,this.clientConditions=new Map,this.trackers=new Map,this.listeners=new Map,this.targetEnv=null,this.idempotencyKeysSeen=new Set,this.testUserIdentified=!1,this.cspIssueReported=!1,this.uiDisabled=!1,this.audio=null,this.audioReady=!1,this.pageTrackingDisabled=!1,this.onBuilderMessage=e=>(this.handleBuilderMessage(e),!1),this.handleBuilderMessage=async e=>{St(`builder ${e.kind} message received`,e);const t="idempotencyKey"in e&&"string"==typeof e.idempotencyKey?e.idempotencyKey:null;if(t&&this.idempotencyKeysSeen.has(t))return;const s=()=>{t&&this.idempotencyKeysSeen.add(t)};switch(e.kind){case"userflow:selectElement":return s(),this.getTargetEnv().postBuilderMessage({kind:"userflow:selectElementAck",idempotencyKey:e.idempotencyKey}),void this.setSessionStorageState((t=>({...t,activeApp:"elementSelection",elementSelection:{mode:"select",elementType:e.elementType}})));case"userflow:selectElementCancel":return void this.setSessionStorageState((e=>({...e,activeApp:null,elementSelection:null})));case"userflow:startFlowWithToken":return s(),this.getTargetEnv().postBuilderMessage({kind:"userflow:startFlowWithTokenAck",idempotencyKey:e.idempotencyKey}),e.testUser?this.identifyTestUser(e.testUser):this.resetTestUser(),void this.onceIdentified((()=>{if(this.startFlowWithToken(e.token),e.isResourceCenter){const t=()=>{const s=this.resourceCenterSession;s&&s.draftMode&&s.flow.id===e.flowId&&(this.openResourceCenter(),this.off("resourceCenterChanged",t))};this.on("resourceCenterChanged",t),t()}}));case"userflow:testTracker":return s(),this.getTargetEnv().postBuilderMessage({kind:"userflow:testTrackerAck",idempotencyKey:e.idempotencyKey}),e.testUser?this.identifyTestUser(e.testUser):this.resetTestUser(),void this.setSessionStorageState((t=>({...t,activeApp:"trackerTesting",trackerTesting:{trackerName:e.trackerName,token:e.token,events:0}})));case"userflow:testTrackerCancel":return void this.setSessionStorageState((e=>({...e,activeApp:null,trackerTesting:null})))}},this.onUrlChange=()=>{this.externalId&&(window.clearTimeout(this.flushUrlChangeTimeout),this.flushUrlChangeTimeout=window.setTimeout((()=>this.flushUrlChange()),50))},this.onUserActivity=()=>this.ensureConnected(),St("constructor, build=1001428"),Q(this.onUrlChange),this.setTargetEnv(new te),this.checkTestUserAtBoot(),this.startPollVersionChange(),this.completeSelfUpgrade(),this.toggleUI()}get socketStatus(){return this._socketStatus}destroy(){St("destroy"),this.reset(),Z(this.onUrlChange),this.destroyTargetEnv(),window.clearTimeout(this.protocolVersionUpgradeTimeout),this.cancelPollVersionChange&&this.cancelPollVersionChange()}setTargetEnv(e){this.destroyTargetEnv(),this.targetEnv=e,e.onBuilderMessage(this.onBuilderMessage)}destroyTargetEnv(){this.targetEnv&&(this.targetEnv.destroy(),this.targetEnv=null)}getTargetEnv(){if(!this.targetEnv)throw new B("Userflow.js: Cannot call getTargetEnv when protocol is not set");return this.targetEnv}setSessionStorageState(e){const t=e(this.getSessionStorageState());$.setItem("userflowClientState",JSON.stringify(t)),this.sessionStorageState=t,this.toggleUI()}getSessionStorageState(){let e=this.sessionStorageState;if(!e){const s=$.getItem("userflowClientState");if(s)try{e=JSON.parse(s)}catch(t){console.error("Userflow.js: Parse ElementSelectionState error:",t)}e||(e={testUser:null,activeApp:null,elementSelection:null,trackerTesting:null})}return e}checkTestUserAtBoot(){const e=this.getSessionStorageState().testUser;e&&(St("checkTestUserAtBoot identifying test user"),this.identifyTestUser(e))}async identifyTestUser(e){this.setSessionStorageState((t=>({...t,testUser:e}))),this.reset(),this.init(e.clientToken),this.testUserIdentified=!0,this.externalId=e.id;const t=[this.identify(e.id,{name:e.name,email:e.email,signed_up_at:{set_once:(new Date).toISOString(),data_type:"datetime"}},{signature:e.signature})],{group:s}=e;s&&(this.groupId=s.id,t.push(this.group(s.id,{name:s.name},{signature:s.signature}))),await Promise.all(t)}resetTestUser(){this.setSessionStorageState((e=>({...e,testUser:null})))}init(e){if(St("init",e),!e)throw new B("userflow.init() was called but missing Userflow.js Token");this.clientToken!==e&&(this.testUserIdentified?St("init() ignoring new token since a test user has been identified"):(this.clientToken&&(St("init() resetting due to new client token"),this.reset()),this.clientToken=e))}ensureInit(){if(!this.clientToken)throw new B("You must call userflow.init() first")}ensureIdentified(){if(this.ensureInit(),!this.externalId)throw new B("You must call userflow.identify() first");return this.externalId}ensureGroup(){if(this.ensureIdentified(),!this.groupId)throw new B("You must call userflow.group() first");return this.groupId}ensureConnected(){if(!this.clientToken||!this.externalId)return;if(this.debounceInactiveDisconnect(),this.socket)return;this._socketStatus="connecting",St("connecting to socket");let e="e.userflow.com";"js.getuserflow.com"===new URL(Rt).hostname&&"e.userflow.com"===e&&(e="e.getuserflow.com");const t="wss://"+e+"/end-users/"+this.clientToken+"/socket";this.socket=new v(t,{reconnectAfterMs:e=>[100,500,1e3,5e3][e-1]||1e4,timeout:2e4}),this.socket.connect(),this.socket.onOpen((()=>{St("socket opened")})),this.socket.onError((e=>{console.error("Userflow.js socket error",e),this.reportCspIssue()})),this.channel=this.socket.channel(`end_users:${this.externalId}`,(()=>this.makeChannelJoinPayload())),this.channel.join().receive("ok",(e=>{this.featureFlags=new Set(e.featureFlags),St("channel joined"),"connected"!==this._socketStatus&&(this._socketStatus="connected")})).receive("error",(e=>{if(["company_closed","invalid_client_token","invalid_user_external_id","incorrect_user_signature","rate_limit_exceeded","user_signature_required"].includes(e.code))console.error("Userflow.js: "+e.message),this.reset(),this.clientToken=null;else if("invalid_protocol_version"===e.code){if(!this.protocolVersionUpgradeTimeout){const t=Math.round(5e3+1e4*Math.random());console.warn(`Userflow.js has outdated protocol_version, self-upgrading in ${t} ms...`,e),this.protocolVersionUpgradeTimeout=window.setTimeout((()=>{this.selfUpgrade()}),t)}}else console.error("Userflow.js channel join error",e)})),this.channel.on("server_message",(e=>this.handleServerMessage(e))),this.channel.on("server_error",(e=>{console.error(`Userflow.js server error (${e.code}): ${e.message}`+(e.details&&e.details.length>0?"\nDetails:\n"+e.details.map((e=>(e.path?`${e.path}: `:"")+e.message)):""))}))}makeChannelJoinPayload(){const e=this.buildClientContext();this.clientContext=e;const t={protocolVersion:2,userflowClientBuild:"1001428",signature:this.signature,groupExternalId:this.groupId,groupSignature:this.groupSignature,flowSessionId:this.flowSession?.id||null,checklistSessionId:this.checklistSession?.id||null,resourceCenterSessionId:this.resourceCenterSession?.id||null,launchers:this.launcherSessions.map((e=>({flowId:e.flow.id}))),trackers:Array.from(this.trackers.values()).map((e=>({flowId:e.tracker.flowId}))),hasDraftSession:this.hasDraftSession(),clientConditions:Array.from(this.clientConditions.values()).map((e=>({conditionId:e.condition.id,isTrue:e.isTrue}))),clientContext:e};return St("channel join payload",t),t}disconnect(){window.clearTimeout(this.debounceInactiveDisconnectTimeout),this.socket&&this.socket.disconnect(),this._socketStatus="disconnected",this.socket=null,this.channel=null}debounceInactiveDisconnect(){window.clearTimeout(this.debounceInactiveDisconnectTimeout),this.debounceInactiveDisconnectTimeout=window.setTimeout((()=>{this.hasDraftSession()?this.debounceInactiveDisconnect():(St("disconnecting from socket due to inactivity"),this.disconnect())}),3e5)}hasDraftSession(){return!!this.flowSession?.draftMode||!!this.checklistSession?.draftMode||!!this.resourceCenterSession?.draftMode||this.launcherSessions.some((e=>e.draftMode))}async send(e,{batch:t,handlesRejection:s}={}){return this.inBatch&&["ToggleClientCondition","UpdateClientContext"].includes(e.kind)||this.checkPushRateLimit(),this.ensureConnected(),t&&!this.inBatch&&(this.inBatch=!0,this.sendRaw({kind:"BeginBatch"})),this.inBatch&&(window.clearTimeout(this.endBatchTimeout),this.endBatchTimeout=window.setTimeout((()=>{this.inBatch=!1,this.sendRaw({kind:"EndBatch"})}),50)),this.sendRaw(e,{handlesRejection:s})}async sendRaw(e,{handlesRejection:t}={}){return new Promise(((s,i)=>{if(!this.channel)throw Error("Userflow.js: send() should not be called if channel is not set");St(`push ${e.kind} message`,e);const n=this.clientClock,o=()=>{this.serverClock=n,this.channel?.off("phx_error",r)},r=this.channel.on("phx_error",(s=>{o();const n="Userflow.js send got phx_error";console.error(n,"\nClient message:",e,"\nError:",s),t&&i(new B(n))}));this.channel.push("client_message",e).receive("ok",(e=>{o(),s(e)})).receive("error",(t=>{o();const s=`Userflow.js error reply (${t.code}): ${t.message}`;console.error(s,"\nClient message:",e,"\nError:",t),i(new B(s,t.code))}))}))}checkPushRateLimit(){const e=Date.now();if(this.pushRateLimitMinuteExpires<e&&(this.pushRateLimitMinute=0,this.pushRateLimitMinuteExpires=e+6e4),this.pushRateLimitMinute>=100)throw new B("This Userflow.js client has reached a maximum of 100 operations in the last 1 minute. This is usually due to one of the following:\n\n        - Excessive calls to Userflow.js. Check if any of userflow.track(), userflow.identify(), userflow.updateUser() or similar are called repeatedly.\n        - The URL changing too frequently. Look into https://userflow.com/docs/userflow-js#seturlfilter and filter out the changing part of the URL.\n        - The user legitimately being very active, in which case you can just ignore this error.\n        \n        If in doubt, reach out to us at support@userflow.com.");this.pushRateLimitMinute++}handleServerMessage(e){St(`received ${e.kind} message`,e);const{serverClock:t,flowSession:s,flowSessionClock:i,checklistSession:n,checklistSessionClock:o,resourceCenterSession:r}=this;switch(e.kind){case"CheckSessionsAck":case"ServerDebug":return;case"AddLauncher":{const{session:t}=e,s=this.launcherSessions.findIndex((e=>e.flow.id===t.flow.id));return this.launcherSessions=-1===s?[...this.launcherSessions,t]:[...this.launcherSessions.slice(0,s),t,...this.launcherSessions.slice(s+1)],void this.toggleUI()}case"AddTracker":return void this.addTracker(e.tracker);case"ChecklistTaskCompleted":return void this.unackedTasks.add(e.taskCvid);case"ForceGoToStep":return i>t?void St(`ignoring ${e.kind} message due to stale clock flowSessionClock=${i} > serverClock=${t}`):void(s?.id===e.sessionId&&this.emit("gotostep",{session:s,step:{id:e.stepId}}));case"RemoveLauncher":return void(this.removeLauncher(e.flowId)&&this.toggleUI());case"RemoveTracker":return void this.removeTracker(e.flowId);case"SetChecklistSession":return void(o<=t||n?.id===e.session.id?(this.setChecklistSession(e.session,t),this.toggleUI()):St(`ignoring ${e.kind} message due to stale clock checklistSessionClock=${o} > serverClock=${t}`));case"SetFlowSession":return void(i<=t||s?.id===e.session.id?(this.setFlowSession(e.session,t),this.toggleUI()):St(`ignoring ${e.kind} message due to stale clock flowSessionClock=${i} > serverClock=${t}`));case"SetResourceCenterSession":return this.setResourceCenterSession(e.session),void this.toggleUI();case"TrackClientCondition":return void this.trackClientCondition(e.condition);case"UnsetChecklistSession":return o>t?void St(`ignoring ${e.kind} message due to stale clock checklistSessionClock=${o} > serverClock=${t}`):void(n?.id===e.sessionId&&(this.setChecklistSession(null,t),this.toggleUI()));case"UnsetFlowSession":return i>t?void St(`ignoring ${e.kind} message due to stale clock flowSessionClock=${i} > serverClock=${t}`):void(s?.id===e.sessionId&&(this.setFlowSession(null,t),this.toggleUI()));case"UnsetResourceCenterSession":return void(r?.id===e.sessionId&&(this.setResourceCenterSession(null),this.toggleUI()));case"UntrackClientCondition":return void this.untrackClientCondition(e.conditionId);default:return void console.warn("Userflow.js: Received unknown message",e)}}async identify(e,t={},{signature:s}={}){if(St("identify",e),this.ensureInit(),this.testUserIdentified&&e!==this.externalId)St("identify() ignored since a test user has been identified");else{if("number"==typeof e)e=String(e);else if(!e||"string"!=typeof e)return void this.warn("Userflow.identify: First argument must be a non-empty string representing the user's ID in your database. Value received:",e);this.externalId&&e!==this.externalId&&(St("identify resetting due to new externalId"),this.reset()),this.externalId=e,this.signature=s||null,this.observeUserActivity(),await Promise.all([this.send({kind:"UpsertUser",attributes:this.normalizeAttributes(t)},{batch:!0}),this.onFirstIdentify()]),this.emit("private:identified")}}async identifyAnonymous(e={},t={}){const s="anonymousId";let i=x.getItem(s);i||(i="anon-"+j(),x.setItem(s,i)),await this.identify(i,e,t)}async updateUser(e={},t={}){St("updateUser"),this.ensureIdentified(),await this.send({kind:"UpsertUser",attributes:this.normalizeAttributes(e)},{batch:!0})}async group(e,t={},{signature:s,membership:i}={}){if(St("group",e),this.ensureIdentified(),this.testUserIdentified&&e!==this.groupId)St("group() ignored since a test user has been identified");else{if("number"==typeof e)e=String(e);else if(!e||"string"!=typeof e)return void this.warn("Userflow.group: First argument must be a non-empty string representing the group's ID in your database. Value received:",e);this.groupId=e,this.groupSignature=s||null,await this.send({kind:"UpsertGroup",groupExternalId:e,groupSignature:this.groupSignature,groupAttributes:this.normalizeAttributes(t),membershipAttributes:this.normalizeAttributes(i)},{batch:!0})}}async updateGroup(e={},t={}){St("updateGroup");const s=this.ensureGroup();await this.send({kind:"UpsertGroup",groupExternalId:s,groupSignature:this.groupSignature,membershipAttributes:this.normalizeAttributes(t.membership),groupAttributes:this.normalizeAttributes(e)},{batch:!0})}normalizeAttributes(e){if(null==e)return{};if("object"!=typeof e)throw new B("Userflow: 'attributes' must be an object.");const t={};for(const s in e){if(!e.hasOwnProperty(s))continue;if("traits"===s){const i=e[s];Object.assign(t,this.extractLegacyTraits(i));continue}let i=e[s];if("string"==typeof i||"number"==typeof i||"boolean"==typeof i||null==i)t[s]=this.normalizeAttributeLiteral(s,i);else{if("object"!=typeof i||null==i)throw new B(`Userflow: Invalid value for '${s}' attribute.`);if("set"in i)t[s]={set:this.normalizeAttributeLiteral(s,i.set),dataType:this.normalizeDataType(s,i.data_type||i.dataType)};else if("set_once"in i||"setOnce"in i)t[s]={setOnce:this.normalizeAttributeLiteral(s,i.set_once||i.setOnce),dataType:this.normalizeDataType(s,i.data_type||i.dataType)};else if("add"in i){const e=i.add;if("string"!=typeof e&&"number"!=typeof e)throw new B(`Userflow: Invalid 'add' value for '${s}' attribute. Must be a number or string.`);t[s]={add:e}}else{if(!("subtract"in i))throw new B(`Userflow: Invalid value for '${s}' attribute.`);{const e=i.subtract;if("string"!=typeof e&&"number"!=typeof e)throw new B(`Userflow: Invalid 'subtract' value for '${s}' attribute. Must be a number or string.`);t[s]={subtract:e}}}}}return t}normalizeAttributeLiteral(e,t){if(null==t)return null;if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return t;throw new B(`Userflow: Invalid value for '${e}' attribute.`)}normalizeDataType(e,t){if(!t)return null;switch(t){case"string":return re.STRING;case"number":return re.NUMBER;case"boolean":return re.BOOLEAN;case"datetime":return re.DATETIME}throw new B(`Userflow: Invalid data_type for '${e}' attribute.`)}extractLegacyTraits(e){if(!e)return{};if(!Array.isArray(e)){const t=[];for(const s in e)e.hasOwnProperty(s)&&t.push({name:s,value:e[s]});e=t}return e.reduce(((e,{name:t,value:s,dataType:i})=>{if("string"!=typeof t||t.length>100||!t.match(/^[a-z0-9_]+$/))return this.warn("Userflow.identify: Invalid trait name (must be string, no more than 100 characters, and only consist of a-z, 0-9 and underscores). The trait will be ignored. Name was:",t),e;if("string"==typeof s);else if("boolean"==typeof s)i||(i="boolean"),s=s?"true":"false";else{if("number"!=typeof s)return this.warn(`Userflow.identify: The value of trait '${t}' is invalid (must be a string, a boolean or a number). The trait will be ignored. Value was:`,s),e;i||(i=Number.isInteger(s)?"integer":"decimal"),s=String(s)}let n=null;if(i)switch(i){case"string":n=re.STRING;break;case"boolean":n=re.BOOLEAN;break;case"integer":case"decimal":n=re.NUMBER;break;case"datetime":n=re.DATETIME;break;default:return this.warn(`Userflow.identify: The data type of trait '${t}' is invalid (must be a 'string', 'boolean', 'integer', 'decimal' or 'datetime'). The trait will be ignored. Data type was:`,i),e}return e[t]={set:s,dataType:n},e}),{})}async track(e,t={},{userOnly:s}={}){St(`track '${e}'`,t),this.ensureIdentified(),await this.send({kind:"TrackEvent",userOnly:!!s,name:e,attributes:this.normalizeEventAttributes(t)},{batch:!0})}normalizeEventAttributes(e){const t=this.normalizeAttributes(e);for(const s in t){if(!t.hasOwnProperty(s))continue;const e=t[s];if(null!=e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e&&!("set"in e))throw new B(`Userflow: Invalid value for '${s}' attribute. Event attributes only support literal values and 'set' changes.`)}return t}onFirstIdentify(){this.onFirstIdentifyRun||(this.onFirstIdentifyRun=!0,this.trackPageViewed(),this.firstIdentifyCallback?(this.firstIdentifyCallback(),this.firstIdentifyCallback=null):this.checkUrlForStartFlow())}onceIdentified(e){this.isIdentified()?e():this.firstIdentifyCallback=e}checkUrlForStartFlow(){const e=new URL(W()),t=e.searchParams.get("userflow")||e.searchParams.get("studio1_flow")||e.searchParams.get("studio1_walkthrough");t&&(St(`url contained flow ${t}`),this.startFlow({flowId:t,startReason:ne.LINK,batch:!0}),e.searchParams.delete("userflow"),e.searchParams.delete("studio1_flow"),e.searchParams.delete("studio1_walkthrough"),window.history.replaceState({},"",e.toString()),this.clientContext=this.buildClientContext(),this.pushUpdateClientContext())}flushUrlChange(){const e=this.buildClientContext();this.clientContext&&e.pageUrl===this.clientContext.pageUrl||(this.clientContext=e,this.pushUpdateClientContext(),this.trackPageViewed(),this.checkUrlForStartFlow())}async trackPageViewed(){this.pageTrackingDisabled||this.track("page_viewed",{},{userOnly:!0})}buildClientContext(){return{pageUrl:Tt(),viewportWidth:window.innerWidth,viewportHeight:window.innerHeight}}pushUpdateClientContext(){this.send({kind:"UpdateClientContext",clientContext:this.clientContext},{batch:!0})}ackCompletedTask(e){this.unackedTasks.delete(e)}taskIsUnacked(e){return this.unackedTasks.has(e)}isIdentified(){return null!=this.externalId}on(e,t){let s=this.listeners.get(e);s||(s=new Set,this.listeners.set(e,s)),s.add(t)}off(e,t){const s=this.listeners.get(e);s&&s.delete(t)}emit(e,...t){const s=this.listeners.get(e);if(s){Array.from(s).forEach((e=>e(...t)))}}observeUserActivity(){document.addEventListener("mouseover",this.onUserActivity),document.addEventListener("pointerdown",this.onUserActivity),document.addEventListener("keydown",this.onUserActivity)}unobserveUserActivity(){document.removeEventListener("mouseover",this.onUserActivity),document.removeEventListener("pointerdown",this.onUserActivity),document.removeEventListener("keydown",this.onUserActivity)}reset(){St("reset"),this.externalId=null,this.groupId=null,this.sessionStorageState=null,this.setFlowSession(null,0),this.setChecklistSession(null,0),this.setResourceCenterSession(null),this.launcherSessions=[],this.activeLauncherFlowId=null,this.notifications=[],this.unackedTasks=new Set,this.onFirstIdentifyRun=!1,this.clientContext=null,this.unobserveUserActivity(),window.clearTimeout(this.flushUrlChangeTimeout),this.flushUrlChangeTimeout=void 0,this.clientConditions.forEach(((e,t)=>{this.untrackClientCondition(t)})),this.firstIdentifyCallback=null,this.testUserIdentified=!1,x.removeItem("anonymousId"),this.unmountUI(),this.disconnect(),this.inBatch=!1,window.clearTimeout(this.endBatchTimeout),this.endBatchTimeout=void 0,this.clientClock=1,this.serverClock=1}async startFlow({flowId:e,stepCvid:t,startReason:s,once:i,batch:n,replaceCurrent:o}){if(this.ensureIdentified(),o&&this.flowSession&&this.endFlow(this.flowSession,{endReason:se.REPLACED,batch:!0}),St(`startFlow ${e}`,{startReason:s}),this.checklistSession?.flow.id===e)return St("startFlow matches current checklist, so showing it instead"),void this.showChecklist();const r={kind:"StartFlow",flowId:e,stepCvid:t,startReason:s,once:!!i};await this.send(r,{batch:n})}async startFlowWithToken(e){this.ensureIdentified(),St("startFlowWithToken",{token:e}),await this.send({kind:"StartFlowWithToken",token:e},{batch:!0})}optimisticClockUIUpdate(e){this.clientClock++,e(),this.toggleUI()}async showChecklist(){this.resourceCenterEmbedsChecklist()?this.openResourceCenter():(this.unmarkExpandPending(),this.checklistSession&&!this.checklistExpanded&&(this.ensureIdentified(),this.checklistExpanded=!0,this.toggleUI(),$.setItem(`checklistExpanded:${this.checklistSession.id}`,"1"),await this.send({kind:"ShowChecklist",sessionId:this.checklistSession.id},{batch:!0})))}async hideChecklist(){this.resourceCenterEmbedsChecklist()?this.closeResourceCenter():this.checklistSession&&this.checklistExpanded&&(this.ensureIdentified(),this.checklistExpanded=!1,this.toggleUI(),$.removeItem(`checklistExpanded:${this.checklistSession.id}`),await this.send({kind:"HideChecklist",sessionId:this.checklistSession.id},{batch:!0}))}async unmarkExpandPending(){this.checklistSession&&this.checklistExpandPending&&(this.checklistExpandPending=!1,await this.send({kind:"UnmarkExpandPending",sessionId:this.checklistSession.id},{batch:!0}))}async openResourceCenter(){this.resourceCenterEmbedsChecklist()&&this.unmarkExpandPending(),this.resourceCenterSession&&!this.resourceCenterOpen&&(this.ensureIdentified(),this.resourceCenterOpen=!0,this.toggleUI(),this.emit("resourceCenterChanged"),$.setItem(`resourceCenterOpen:${this.resourceCenterSession.id}`,"1"),await this.send({kind:"OpenResourceCenter",sessionId:this.resourceCenterSession.id},{batch:!0}))}async closeResourceCenter(){this.resourceCenterSession&&this.resourceCenterOpen&&(this.ensureIdentified(),this.resourceCenterOpen=!1,this.toggleUI(),this.emit("resourceCenterChanged"),$.removeItem(`resourceCenterOpen:${this.resourceCenterSession.id}`),await this.send({kind:"CloseResourceCenter",sessionId:this.resourceCenterSession.id},{batch:!0}))}toggleResourceCenter(){this.resourceCenterOpen?this.closeResourceCenter():this.openResourceCenter()}setResourceCenterLauncherHidden(e){this.resourceCenterLauncherHidden=e,this.toggleUI()}getResourceCenterState(){if(!this.resourceCenterSession)return null;const e=this.resourceCenterEmbedsChecklist(),{checklistSession:t}=this;return{isOpen:this.resourceCenterOpen,hasChecklist:e,uncompletedChecklistTaskCount:e&&t?Ut(t):0}}resourceCenterEmbedsChecklist(){const e=this.resourceCenterSession;return!!e&&!!e.version.resourceCenter?.blocks.some((e=>e.type===ze.CHECKLIST))}async endFlow(e,{endReason:t,batch:s}){this.ensureIdentified(),this.optimisticClockUIUpdate((()=>{const{clientClock:t}=this;this.flowSession?.id===e.id&&this.setFlowSession(null,t),this.checklistSession?.id===e.id&&this.setChecklistSession(null,t),this.resourceCenterSession?.id===e.id&&this.setResourceCenterSession(null)}));const{flow:i}=e,n={id:i.id,type:i.type.toLowerCase()};i.type===ce.CHECKLIST?this.emit("checklistEnded",{checklist:n,endReason:t}):i.type===ce.FLOW&&this.emit("flowEnded",{flow:n,endReason:t});const o={kind:"EndFlow",sessionId:e.id,endReason:t};await this.send(o,{batch:s})}async goToStep(e,t){St("goToStep",e.id,t.name||t.id),this.ensureIdentified();const s=this.send({kind:"GoToStep",sessionId:e.id,stepId:t.id});this.emit("gotostep",{session:e,step:t}),await s}async endAllFlows(){St("endAllFlows"),this.optimisticClockUIUpdate((()=>{const{clientClock:e}=this;this.setFlowSession(null,e),this.setChecklistSession(null,e)})),await this.send({kind:"EndAllFlows"})}async endChecklist(){St("endChecklist");const e=this.checklistSession||this.flowSession;e?.flow.type===ce.CHECKLIST&&this.endFlow(e,{endReason:se.USERFLOWJS})}setFlowSession(e,t=this.clientClock){const s=this.flowSession;this.flowSession=e,this.flowSessionClock=t,e&&!s&&(this.hideChecklist(),this.closeResourceCenter()),null==e&&this.originalActiveElement&&("function"==typeof this.originalActiveElement.focus&&this.originalActiveElement.focus(),this.originalActiveElement=void 0)}setChecklistSession(e,t=this.clientClock){const s=this.checklistSession;this.checklistSession=e,this.checklistSessionClock=t,null===e&&(this.checklistExpanded=!1,this.checklistExpandPending=!1),e&&e.id!==s?.id&&(this.checklistExpanded=!!$.getItem(`checklistExpanded:${e.id}`),e.expandPending&&(this.checklistExpandPending=!0)),this.emit("checklistChanged"),this.emit("resourceCenterChanged")}setResourceCenterSession(e){const t=this.resourceCenterSession;this.resourceCenterSession=e,null===e&&(this.resourceCenterOpen=!1),t&&t.id!==e?.id&&$.removeItem(`resourceCenterOpen:${t.id}`),e&&e.id!==t?.id&&(this.resourceCenterOpen=!!$.getItem(`resourceCenterOpen:${e.id}`)),this.emit("resourceCenterChanged")}launcherSeen(e){this.send({kind:"StartFlow",flowId:e,startReason:ne.LAUNCHER_SEEN,once:!1})}activateLauncher(e){const t=this.activeLauncherFlowId&&this.launcherSessions.find((e=>e.flow.id===this.activeLauncherFlowId));t&&this.deactivateLauncher(t),this.activeLauncherFlowId=e.flow.id,this.toggleUI(),this.send({kind:"ActivateLauncher",flowId:e.flow.id})}deactivateLauncher(e){const{launcher:t}=e.version;e.flow.id===this.activeLauncherFlowId&&(t?.dismissOn===et.DEACTIVATE?this.dismissLauncher(e,{endReason:se.LAUNCHER_DEACTIVATED}):(this.activeLauncherFlowId=null,this.toggleUI()))}dismissLauncher(e,{endReason:t}){const s=e.flow.id;this.removeLauncher(s),this.toggleUI(),this.send({kind:"DismissLauncher",flowId:s,endReason:t})}removeLauncher(e){const t=this.launcherSessions.findIndex((t=>t.flow.id===e));return-1!==t&&(this.launcherSessions=[...this.launcherSessions.slice(0,t),...this.launcherSessions.slice(t+1)],e===this.activeLauncherFlowId&&(this.activeLauncherFlowId=null),!0)}async toggleUI(){this.flowSession||!this.checklistExpandPending&&!this.checklistSession?.version.checklist?.tasks.some((e=>this.taskIsUnacked(e.cvid)))||this.showChecklist(),this.emit("uistatechange"),this.shouldBeMounted()?await this.mountUI():this.unmountUI()}shouldBeMounted(){if(this.uiDisabled)return!1;return!!this.getSessionStorageState().activeApp||!!this.flowSession||!!this.checklistSession&&(this.checklistExpanded||!!this.checklistSession?.version.checklist?.launcherEnabled)||!!this.resourceCenterSession&&(this.resourceCenterOpen||!this.resourceCenterLauncherHidden)||this.launcherSessions.length>0||this.notifications.length>0}async mountUI(){if(!this.ui){const e=await this.createUI();this.shouldBeMounted()&&!this.ui&&(St("mount UI"),this.ui=e,this.ui.mount())}}unmountUI(){this.ui&&(St("unmount UI"),this.ui.unmount(),this.ui=null)}remount(){this.unmountUI(),this.toggleUI()}async createUI(){try{const e=s((()=>import("./ui.25a11814.js")),[new URL("ui.25a11814.js",import.meta.url).toString(),new URL("index.9a316d5c.js",import.meta.url).toString()]);this.resourceCenterSession&&yt();const{RealUI:t}=await e;return new t(this)}catch(e){throw this.reportCspIssue(),e}}async trackClientCondition(e){if(this.clientConditions.has(e.id))return;St("track client condition",e),this.clientConditions.set(e.id,{condition:e,isTrue:null});const{conditionTypes:t}=await s((()=>import("./flow-condition-types.0bd9ae98.js")),[new URL("flow-condition-types.0bd9ae98.js",import.meta.url).toString(),new URL("interpolate-session-data.e82e82f6.js",import.meta.url).toString(),new URL("observe-dom.f94a60e9.js",import.meta.url).toString(),new URL("roots.baec1d67.js",import.meta.url).toString(),new URL("dom-helpers.e87fd37d.js",import.meta.url).toString()]),i=t[e.type],n=this.clientConditions.get(e.id);n&&(n.untrack=i.track({sessionData:[],condition:e,callback:t=>{n.isTrue!==t&&(St("client condition truthiness changed",t,n.condition),n.isTrue=t,this.send({kind:"ToggleClientCondition",conditionId:e.id,isTrue:t},{batch:!0}))}}))}untrackClientCondition(e){const t=this.clientConditions.get(e);t&&(St("untrack client condition",t.condition),t.untrack&&t.untrack(),this.clientConditions.delete(e))}async addTracker(e){let t=this.trackers.get(e.flowId);t?t.tracker=e:this.trackers.set(e.flowId,{tracker:e,isTrue:!1});const{conditionTypes:i}=await s((()=>import("./flow-condition-types.0bd9ae98.js")),[new URL("flow-condition-types.0bd9ae98.js",import.meta.url).toString(),new URL("interpolate-session-data.e82e82f6.js",import.meta.url).toString(),new URL("observe-dom.f94a60e9.js",import.meta.url).toString(),new URL("roots.baec1d67.js",import.meta.url).toString(),new URL("dom-helpers.e87fd37d.js",import.meta.url).toString()]),n=this.trackers.get(e.flowId);if(!n)return;const{tracker:o}=n,{condition:r}=o,a=i[r.type];n.untrack&&n.untrack(),n.untrack=a.track({sessionData:o.data,condition:r,flipBackEvents:!0,callback:e=>{const t=n.isTrue;n.isTrue=e,!t&&e&&this.send({kind:"TrackTrackerEvent",token:o.token},{batch:!0})}}),this.emit("private:trackerStarted")}removeTracker(e){const t=this.trackers.get(e);t&&(t.untrack&&t.untrack(),this.trackers.delete(e),this.emit("private:trackerStopped"))}reportCspIssue(){const e=this.getSessionStorageState();!this.testUserIdentified&&!e.activeApp||this.cspIssueReported||(this.cspIssueReported=!0,St("csp issue detected"),z(window,{kind:"userflow:crxCspIssueDetected"}))}startPollVersionChange(){const e=new URL("version.json",Rt).href;this.cancelPollVersionChange=function({currentBuild:e,versionUrl:t,onUpgradeDetected:s,onUpgradeRequested:i}){const n=parseInt(e,10);if(isNaN(n))return()=>{};let o,r,a=!0,c=null;const h=()=>{o=window.setTimeout(l,6e4)},l=()=>{const e=new XMLHttpRequest;e.addEventListener("load",(()=>{if(!a)return;if(h(),200!==e.status)return;let t;try{t=JSON.parse(e.responseText)}catch(f){return}const l=t.minUserflowBuild;if("number"!=typeof l||n>=l)return;const u=t.maxUpgradeDelayMs||0;if(null==c||u<c){window.clearTimeout(o),c=u;const e=Math.floor(Math.random()*u);s(e),r=window.setTimeout((()=>{d(),i()}),e)}})),e.addEventListener("error",(()=>{a&&h()})),e.open("GET",t+"?cachebuster="+Date.now()),e.send()};h();const d=()=>{a=!1,window.clearTimeout(o),window.clearTimeout(r)};return d}({currentBuild:"1001428",versionUrl:e,onUpgradeDetected:e=>{console.warn(`Userflow.js self-upgrade: New version detected. Self-upgrading in ${e} ms`)},onUpgradeRequested:()=>{this.selfUpgrade()}})}selfUpgrade(){console.warn("Userflow.js self-upgrade: Self-upgrading now..."),window.__userflowSelfUpgradeInfo={userflowBuild:"1001428",clientToken:this.clientToken,externalId:this.externalId,groupId:this.groupId,destroy:()=>this.destroy()};const e=document.createElement("script");e.type="module",e.src=Rt+"?self_upgrade="+Date.now(),e.onload=function(){console.warn("Userflow.js self-upgrade: New version loaded")},e.onerror=function(){console.error("Userflow.js self-upgrade: Failed to load new version")},document.head.appendChild(e)}completeSelfUpgrade(){const e=window.__userflowSelfUpgradeInfo;e&&(console.warn("Userflow.js self-upgrade: Booting new version",e),delete window.__userflowSelfUpgradeInfo,e.destroy(),this.clientToken=e.clientToken,this.externalId=e.externalId,this.groupId=e.groupId,this.externalId&&(console.warn("Userflow.js self-upgrade: Rejoining socket"),this.onFirstIdentifyRun=!0,this.ensureConnected(),this.sendRaw({kind:"Rejoin"})))}getAudio(){return this.audio||(this.audio=new Audio),this.audio}playAudio(e){if(document.hidden)return;const t=this.getAudio();e&&(t.src=e);const s=t.play();this.audioReady=!0,s&&s.catch((e=>{e.name}))}pauseAudio(){const e=this.audio;e&&!e.paused&&e.pause()}async getStepSpeech(e,t,s){return(await this.send({kind:"GetStepSpeech",sessionId:e,stepId:t,text:s})).url}featureFlagEnabled(e){return this.featureFlags.has(e)}showNotification(e,t,s){const i={id:++this.notificationIdCounter,label:e,message:t,type:s};this.notifications=[...this.notifications,i],this.toggleUI()}dismissNotification(e){this.notifications=this.notifications.filter((t=>t.id!==e)),this.toggleUI()}warn(...e){console.warn(...e)}}const At=!!window.__userflowSelfUpgradeInfo;if(void 0===window.userflow||window.userflow._stubbed||At){const e=Object.assign(window.userflow||{},function(){const e=new vt;return{_stubbed:!1,init(t){e.init(t)},identify:(t,s={},i={})=>e.identify(t,s,i),identifyAnonymous:(t={},s={})=>e.identifyAnonymous(t,s),isIdentified:()=>e.isIdentified(),updateUser:(t,s={})=>e.updateUser(t,s),group:(t,s={},i={})=>e.group(t,s,i),updateGroup:(t,s={})=>e.updateGroup(t,s),track:(t,s={},i={})=>e.track(t,s,i),start:(t,{once:s}={})=>e.startFlow({flowId:t,startReason:ne.USERFLOWJS,once:s}),startFlow:e=>(console.warn("Userflow.js: userflow.startFlow() has been deprecated. Use userflow.start() instead."),window.userflow.start(e)),startWalk:e=>(console.warn("Userflow.js: userflow.startWalk() has been deprecated. Use userflow.start() instead."),window.userflow.start(e)),endAll:()=>e.endAllFlows(),endChecklist:()=>e.endChecklist(),endAllFlows:()=>window.userflow.endAll(),async endFlow(){console.warn("Userflow.js: userflow.endFlow() has been deprecated and no longer has any effect.")},async endWalk(){console.warn("Userflow.js: userflow.endWalk() has been deprecated and no longer has any effect.")},openResourceCenter(){e.openResourceCenter()},closeResourceCenter(){e.closeResourceCenter()},toggleResourceCenter(){e.toggleResourceCenter()},setResourceCenterLauncherHidden(t){e.setResourceCenterLauncherHidden(t)},getResourceCenterState:()=>e.getResourceCenterState(),setWalkPosition(){console.warn("Userflow.js: userflow.setWalkPosition() has been deprecated and no longer has any effect.")},reset(){e.reset()},remount(){e.remount()},on(t,s){e.on(t,s)},off(t,s){e.off(t,s)},setCustomInputSelector(e){console.warn("Userflow.js: userflow.setCustomInputSelector() has been deprecated. Use userflow.registerCustomInput() instead. See docs: https://userflow.com/docs/userflow-js"),e&&mt.customInputs.push({cssSelector:e})},registerCustomInput(e,t){mt.customInputs.push({cssSelector:e,getValue:t})},setCustomNavigate(e){mt.customNavigate=e},setUrlFilter(e){mt.urlFilter=e},setInferenceAttributeNames(e){mt.inferenceAttributeNames=e},setInferenceAttributeFilter(e,t){mt.inferenceAttributeFilters[e]=wt(t)},setInferenceClassNameFilter(e){mt.inferenceClassNameFilters=wt(e)},setScrollPadding(e){mt.scrollPadding=e},setCustomScrollIntoView(e){mt.customScrollIntoView=e},prepareAudio(){e.playAudio(null)},setShadowDomEnabled(e){console.warn("Userflow.js: userflow.setShadowDomEnabled() has been deprecated. Please remove this call from your Userflow.js snippet. Shadow DOM is supported by default now.")},setPageTrackingDisabled(t){e.pageTrackingDisabled=t},_setTargetEnv(t){e.setTargetEnv(t)}}}());window.userflow=e,window.studio1=e,function(){const e=window.userflow,t=window.USERFLOWJS_QUEUE;if(delete window.USERFLOWJS_QUEUE,!t||0===t.length)return;St(`processing ${t.length} items in the queue`);for(const[s,i,n]of t){if("function"!=typeof e[s]){console.error(`Userflow.js: Invalid method '${s}' in queue`);continue}const t=e[s](...n);i&&t instanceof Promise&&t.then(i.resolve,i.reject)}St("queue processed")}()}export{re as A,ue as B,Xe as C,Qe as D,se as E,$e as F,st as G,lt as H,nt as I,rt as J,ct as L,Ce as M,yt as R,ne as S,ye as T,B as U,Re as V,s as _,He as a,We as b,mt as c,St as d,Oe as e,be as f,Tt as g,ze as h,Ut as i,ke as j,Fe as k,ce as l,je as m,me as n,Q as o,x as p,Ke as q,Ee as r,G as s,Et as t,Z as u,De as v,Ae as w,le as x,pe as y,Ne as z};
