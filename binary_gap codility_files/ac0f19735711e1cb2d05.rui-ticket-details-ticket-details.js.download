/*! For license information please see ac0f19735711e1cb2d05.rui-ticket-details-ticket-details.js.LICENSE.txt */
(globalThis.webpackChunkcodility=globalThis.webpackChunkcodility||[]).push([[6879],{30867:(t,e,n)=>{"use strict";var i=n(67294),o=n(20637),s=n(77224),a=n(54830),c=n(42751),r=n(53181),l=n(7929),d=n(92091),u=n(89320);function p(t){t.find(".js-try-solution").click((function(t){t.preventDefault(),$(this).closest("form").submit()}))}function m(t,e,n){let i=t.firstChild;for(;i;)e(i),m(i,e,n),n(i),i=i.nextSibling}function h(t,e){const n=[];return t&&n.push(t.className),e&&n.push("idiff"),n.join(" ")}function f(t,e){const n=[],i=[];m(t,(t=>{if(3===t.nodeType)for(let e=0;e<t.data.length;e++)n.push(i[i.length-1]);else i.push(t)}),(t=>{3!==t.nodeType&&i.pop()}));const o=$(e).text(),s=$(t).text();if(o.length){const e=s.indexOf(o),i=e+o.length,a=[];let c,r,l=null;for(let t=0;t<s.length;t++){if(c=n[t],r=t>=e&&t<i,(c!==l||e===t||t===i)&&((l||t>e||t===i)&&a.push("</span>"),c||r||t===i)){const t=h(c,r);a.push(`<span class='${t}' />`)}let o=s[t];"<"===o?o="&lt;":">"===o?o="&gt;":"&"===o&&(o="&amp;"),a.push(o),l=c}(l||r)&&a.push("</span>"),t.innerHTML=a.join("")}}function k(t){return"pas"===t?"delphi":"sql-postgres"===t||"mysql"===t?"sql":t}const g={};function b(t,e,n){let{solutions:i,task_changes:s}=e,{focus_inactive:a,start_time:c,end_time:r,start_label:l,end_label:d}=n;const u=Math.min(s[0].timestamp,c),m=Math.max(s[s.length-1].timestamp,r),h=m-u;function b(t){return t<u?0:(t-u)/h*.98+.01}function v(t){return Math.round(600*b(t))}const x=function(t){let e=null;for(let n=0;n<t.length;n++)""!==t[n].mode&&(e=t[n]),e&&(t[n].prevSubmit=e);e=null;for(let n=t.length-1;n>=0;n--)""!==t[n].mode&&(e=t[n]),e&&(t[n].nextSubmit=e);const n=[];for(let e=0;e<t.length;e++){const i=t[e];""===i.mode&&(i.prevSubmit&&i.timestamp-i.prevSubmit.timestamp<=2||i.nextSubmit&&i.nextSubmit.timestamp-i.timestamp<=2)||(i.idx=e,n.push(i))}return n}(i),w=$(`#solution-slider-${t}`);let y=null;function _(e){if(e===y)return;const n=`task-${t}-submit-current`,i=$(`#solution-placeholder-${t}`);null!==y&&$(`#${n}`).hide(),i.empty();const s=$(`#task-${t}-submit-${x[e].idx}`).clone();s.attr("id",n),i.append(s),s.position(i.position);let a=s.find(".solution-sourcecode-print pre code").get(0);if(a)!function(t){const e=$(t).parent().attr("data-sh-highlight"),n={},i=$(t).data("prg-lang");let s;if(e&&(s=JSON.parse(e)),$(s).each(((t,e)=>{n[e]=!0})),"txt"===i)$(t).addClass("no-highlight hljs"),$(t).css("white-space","pre-wrap");else{const e=k(i);$(t).addClass(`language-${e}`)}o.Z.highlightElement(t),$(t).html($(t).html().split("\n").map(((t,e)=>`<span class='line ${function(t){return t in n?"hll":""}(e+1)}'>${t}</span>`)).join("\n")),$(t).closest(".solution-summary").find(".js-popup-source").click((e=>{e.preventDefault();const n=["location=0","resizable=1","menubar=0","scrollbars=1","left="+(window.screen.width-750)/2,"top="+(window.screen.height-400)/2,"width=750","height=400"].join(","),i=window.open("","_blank",n);i.document.write('<pre style="white-space: pre-wrap; word-wrap: break-word;"></pre>'),$("pre",i.document).text($(t).text()),i.document.close(),i.focus()}))}(a);else{const t=s.find(".diff-container").attr("data-prg-lang");a=s.find(".diff-container .diff-file tbody"),function(t,e){const n=k(e),i=!!o.Z.getLanguage(n);let s;$(t).find("tr td.line_content").each(((t,e)=>{const a=$(e).text(),c=$(e).find(".idiff")[0];let r;if(i){const t=o.Z.highlight(n,a,!0,s);s=t.top,r=$(e).html(t.value)[0]}else r=e;c?f(r,c):$(e).html($(r).html())}))}(a,t)}p(i),$(`#${n} [data-content]`).popup(),s.height()>g[t]&&(g[t]=s.height()),i.css("min-height",g[t]),s.show(),y=e}function C(t){_(t),w.slider("value",v(x[t].timestamp))}function j(t){const e=w.find("span");e.attr("aria-valuemin",0),e.attr("aria-valuemax",600),e.attr("aria-valuenow",v(t.timestamp)),e.attr("aria-valuetext",t.timestring)}function S(t){let e=0;for(;e<x.length-1&&v(x[e+1].timestamp)<=t;)e+=1;j(x[e]),_(e)}const T={min:0,max:600,slide(){S(w.slider("value"))},stop(){S(w.slider("value"))}};w.slider(T);let E=x.length-1;for(let t=0;t<x.length;t++)"final"===x[t].mode&&(E=t);C(E),$(`#timeline-${t}-next`).button({icons:{primary:"ui-icon-seek-next"},text:!1}).click((function(){let t=y+1;for(;t<x.length&&""===x[t].mode;)t+=1;t===x.length&&(t-=1),C(t)})),$(`#timeline-${t}-prev`).button({icons:{primary:"ui-icon-seek-prev"},text:!1}).click((function(){let t=y-1;for(;t>=0&&""===x[t].mode;)t-=1;t<0&&(t=0),C(t)})),$(`#timeline-${t}-rewind`).button({icons:{primary:"ui-icon-seek-first"},text:!1}).click((()=>{C(0)})),$(`#timeline-${t}-forward`).button({icons:{primary:"ui-icon-seek-end"},text:!1}).click((()=>{C(x.length-1)}));let I=null;function M(){null!==I&&(clearInterval(I),I=null)}function Z(){const e=$(`<div id="task-${t}-timeline" class="task-timeline"></div>`);function n(t,n,i){const o=$(`<div class="${t}bar"></div>`);o.appendTo(e),o.css("left",b(n)*e.width()),o.css("width",(b(i)-b(n))*e.width()),o.attr("note",`${n}:${i}`)}e.appendTo($(`#solution-timeline-container-${t}`));const i=[];let o,c=!1;for(let t=0;t<s.length;t++){if(!s[t].to_current&&c){for(let e=t+1;e<s.length&&s[e].timestamp-s[t].timestamp<300;e++)s[e].to_current;i.push([o,s[t].timestamp]),c=!1}s[t].to_current&&!c&&(c=!0,o=s[t].timestamp)}c&&i.push([o,m]),i.sort();const r=[];$.each(i,((t,e)=>{r.push([e[0],"work_start"]),r.push([e[1],"work_end"])})),$.each(a,((t,e)=>{r.push([e.start_time,"inactive_start"]),r.push([e.end_time,"inactive_end"])})),r.sort();let l=!0,d=!1,u=null;function p(t){C(t.data)}$.each(r,((t,e)=>{const i=e[0];switch(null!==u&&d&&u<i&&(l?function(t,e){n("work",t,e)}(u,i):function(t,e){n("inactive",t,e)}(u,i)),u=i,e[1]){case"work_start":d=!0;break;case"work_end":d=!1;break;case"inactive_start":l=!1;break;case"inactive_end":l=!0}})),w.css("border","0"),e.css("top",4);for(let t=0;t<x.length;t++){if(""===x[t].mode)continue;const n=x[t].mode;let i="verify";"final"!==n&&"verify"!==n&&"paste"!==n||(i=n);const o=$(`<div class="submit-outer outer-${i}"></div>`),s=$(`<div class="submit-inner inner-${i}"></div>`).appendTo(o);e.append(o),o.attr("note",`${x[t].timestamp}`),o.css("left",b(x[t].timestamp)*e.width()),s.click(t,p)}}$(`#timeline-${t}-play`).button({icons:{primary:"ui-icon-play"},text:!1}).click((function(){if(null!==I)return;y===x.length-1&&C(0);const t=w.slider("option","max");I=setInterval((function(){const e=Math.min(t,w.slider("value")+5);w.slider("value",e),S(e),y===x.length-1&&M()}),90)})),$(`#timeline-${t}-stop`).button({icons:{primary:"ui-icon-stop"},text:!1}).click(M),Z(),function(t){const e=w.find("span");e.attr("role","slider"),e.attr("aria-label","Timeline slider"),j(t)}(x[x.length-1]),window.addEventListener("resize",(()=>{$(`#task-${t}-timeline`).remove(),Z()}));const L=$(`#solution-slider-${t}-time-start`),O=$(`#solution-slider-${t}-time-end`);L.text(l),L.attr("aria-label",`Start time: ${l}`),O.text(d),O.attr("aria-label",`End time: ${d}`)}function v(t,e){setTimeout((async()=>{const n=await l.Z.get(t);"OK"===n.status&&(n.ready?window.location.reload(!0):v(t,e))}),e)}window.addEventListener("load",(()=>{(0,u.x)("#js-ticket-detail-data",(t=>{let{shouldRefresh:e,sliderData:n,taskNames:o,taskScores:m,ticketId:h}=t;e&&(!function(){const t=document.querySelector("#loader");t&&(t.style.display="block")}(),v(`/tickets/${h}/is_ready/`,1e4)),function(t){let{taskNames:e,taskScores:n,ticketId:o}=t;const m={change:`/tickets/_ajax_change/${o}/`,timeline:`/tickets/${o}/timeline/`};function h(t,e){$(e).click((0,d._j)((()=>l.Z.post(m.change,$(t).serialize(),{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})),{onSuccess:()=>{window.location.reload()}}))}for(let t=0;t<e.length;++t){const e=`.modify-score-popup-${t}`,n=`.js-keep-system-score-form-${t}`,i=`.js-keep-system-score-${t}`,o=`.js-custom-score-form-${t}`,s=`.js-override-system-score-${t}`;$(`.js-modify-score-edit-button-${t}`).popup({popup:$(e),on:"click",lastResort:!0}),h(n,i),h(o,s);const a=`#sol-desc-${t}`,c=a+"_editor",l=$(c).find("input[name=field]").val();(0,r.c)(l,a,c,m.change)}for(const t of Object.keys(n)){const e=".js-system-score-button-"+t,i=n[t];void 0===i&&$(e).css("background-color","grey"),0===i?$(e).css("background-color","grey"):i<=49?$(e).css("background-color","yellow"):i<=89?$(e).css("background-color","olive"):$(e).css("background-color","green")}$(".ui.radio.checkbox").checkbox(),$(".a-timeline").click((t=>{t.preventDefault(),(0,c.HJ)(m.timeline,{size:"small",header:i.createElement(a.Z.Header,null,"Test timeline"),getActions:t=>i.createElement(a.Z.Actions,null,i.createElement(s.Z,{onClick:t},"Close")),onModalMount:()=>{(0,u.x)("#js-keyboard-events-data",(t=>{let{keyboardEvents:e}=t;$.plot($("#js-keyboard-events-data"),[e],{series:{bars:{show:!0,align:"center",barWidth:.9,fill:.9},shadowSize:0},xaxis:{mode:"time",timeformat:"%H:%M",autoscaleMargin:.02},yaxis:{min:0,autoscaleMargin:.1}})}))}})})),$(".system-score-checkbox").click((function(){$(".custom-score-checkbox").find(":radio").prop("checked",!1)})),$(".custom-score-checkbox").click((function(){$(".system-score-checkbox").find(":radio").prop("checked",!1)})),$(".system-score-button").click((function(){$(".system-score-checkbox").find(":radio").prop("checked",!0),$(".custom-score-checkbox").find(":radio").prop("checked",!1)})),$(".js-custom-score-textbox").click((function(){$(".system-score-checkbox").find(":radio").prop("checked",!1),$(".custom-score-checkbox").find(":radio").prop("checked",!0)})),$(".task-opener a").click((function(){const t=$(this).parents(".task").attr("id");return $(`.${t}-details`).toggle(),!1})),p($("main"))}({taskNames:o,taskScores:m,ticketId:h}),function(t){for(const e in t.tasks){const n=t.tasks[e];g[e]=0,b(e,n,t)}}(n),function(t){const e=$(t);function n(t){return t.find(".expand-icon").not(".expand-icon-rotate").length>0}function i(t){const e=t.find(".expand-link"),i=t.find(".header > b").text();n(t)?(e.text("expand all"),e.attr("aria-label",`Expand all ${i}`)):(e.text("collapse all"),e.attr("aria-label",`Collapse all ${i}`))}e.on("click",".tests-table .test",(function(t){t.preventDefault(),$(this).blur();const e=$(this).closest(".test");e.next().slideToggle(300);const n=e.find(".expand-icon");n.toggleClass("expand-icon-rotate"),n.attr("aria-expanded",(function(t,e){return"false"===e?"true":"false"})),i($(this).closest(".tests-group"))})),e.on("click",".tests-table .expand-link",(function(t){t.preventDefault(),$(this).blur();const e=$(this).closest(".tests-group");n(e)?(e.find(".test-details").slideDown(300),e.find(".expand-icon").addClass("expand-icon-rotate"),e.find(".expand-icon").attr("aria-expanded",!0)):(e.find(".test-details").slideUp(300),e.find(".expand-icon").removeClass("expand-icon-rotate"),e.find(".expand-icon").attr("aria-expanded",!1)),i(e)}))}(document.querySelector(".tasks"))}))}))},53181:(t,e,n)=>{"use strict";n.d(e,{c:()=>a,f:()=>c});var i=n(7929),o=n(92091);class s{constructor(t,e,n,i){this.name=t,this.elemId=e,this.editorId=n,this.postUrl=i,this.elem=$(e),this.editor=$(n),$(n+" .cancel").click((()=>this.cancel())),$(e+" .change").click((()=>this.change())),$(n+" .submit").click((()=>this.submit()))}cancel(){return this.editor.hide(),this.elem.show(),!1}change(){return this.elem.hide(),this.editor.show(),!1}getValue(){return this.editor.find('[name="value"]').val()}submit(){const t=this,e=this.editor.find("form").serialize(),n=$(this.editorId+" .submit").val();return $(this.editorId+" .submit").val("submitting..."),(0,o.Mo)((()=>i.Z.post(this.postUrl,e,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})),{onSuccess:()=>{t.submitOK()},onAfter:()=>{$(t.editorId+" .submit").val(n)}}),!1}submitOK(){"modify_result"!==this.name?($(this.elemId+" span.value").html($("<div/>").text(this.getValue()).html()),this.editor.hide(),this.elem.show()):window.location.reload()}}function a(t,e,n,i){return new s(t,e,n,i)}function c(t,e,n){$(e+" a.cancel").click((function(){return $(e).hide(),$(t).show(),!1})),$(t+" a.change").click((function(){return $(t).hide(),$(e).show(),!1})),$(e+" .submit").click((function(){let i=$(e+' input[name="value"]');0===i.length&&(i=$(e+' textarea[name="value"]'));const o=$(i).val();$(t+" span.value").html($("<div/>").text(o).html()),n(o),$(e).hide(),$(t).show()}))}},82373:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(14293),o=n.n(i);const s=["click","mousedown","mouseup"];function a(t){return!o()(t)&&s.includes(t.type)&&0===t.button}},10257:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});const i=Symbol("id");function o(t,e,n,o){const s=n.id??o.id;if(void 0!==s)return s;const a=(+t[i]||0)+1;return t[i]=a,`${e}-auto-id-${a}`}},89320:(t,e,n)=>{"use strict";n.d(e,{x:()=>o});var i=n(51008);function o(t,e){(0,i.wB)(t).forEach((t=>(0,i.Sm)(t,e)))}},27537:(t,e)=>{function n(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return a[t];var n,s=String(t);return(n=i[s.toLowerCase()])?n:(n=o[s.toLowerCase()])||(1===s.length?s.charCodeAt(0):void 0)}n.isEventKey=function(t,e){if(t&&"object"==typeof t){var n=t.which||t.keyCode||t.charCode;if(null==n)return!1;if("string"==typeof e){var s;if(s=i[e.toLowerCase()])return s===n;if(s=o[e.toLowerCase()])return s===n}else if("number"==typeof e)return e===n;return!1}};var i=(e=t.exports=n).code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},o=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(s=97;s<123;s++)i[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)i[s-48]=s;for(s=1;s<13;s++)i["f"+s]=s+111;for(s=0;s<10;s++)i["numpad "+s]=s+96;var a=e.names=e.title={};for(s in i)a[i[s]]=s;for(var c in o)i[c]=o[c]}},t=>{t.O(0,[2253,7090,5736,3502,9669,5346,8341,4662,7354,9641,637,7116,1171,2091,2751],(()=>(30867,t(t.s=30867)))),t.O()}]);